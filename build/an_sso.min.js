function Base64x(){}function stoBA(a){for(var b=new Array,c=0;c<a.length;c++)b[c]=a.charCodeAt(c);return b}function BAtos(a){for(var b="",c=0;c<a.length;c++)b+=String.fromCharCode(a[c]);return b}function BAtohex(a){for(var b="",c=0;c<a.length;c++){var d=a[c].toString(16);1==d.length&&(d="0"+d),b+=d}return b}function stohex(a){return BAtohex(stoBA(a))}function stob64(a){return hex2b64(stohex(a))}function stob64u(a){return b64tob64u(hex2b64(stohex(a)))}function b64utos(a){return BAtos(b64toBA(b64utob64(a)))}function b64tob64u(a){return a=a.replace(/\=/g,""),a=a.replace(/\+/g,"-"),a=a.replace(/\//g,"_")}function b64utob64(a){return a.length%4==2?a+="==":a.length%4==3&&(a+="="),a=a.replace(/-/g,"+"),a=a.replace(/_/g,"/")}function hextob64u(a){return a.length%2==1&&(a="0"+a),b64tob64u(hex2b64(a))}function b64utohex(a){return b64tohex(b64utob64(a))}function utf8tob64(a){return hex2b64(uricmptohex(encodeURIComponentAll(a)))}function b64toutf8(a){return decodeURIComponent(hextouricmp(b64tohex(a)))}function utf8tohex(a){return uricmptohex(encodeURIComponentAll(a))}function hextoutf8(a){return decodeURIComponent(hextouricmp(a))}function hextorstr(a){for(var b="",c=0;c<a.length-1;c+=2)b+=String.fromCharCode(parseInt(a.substr(c,2),16));return b}function rstrtohex(a){for(var b="",c=0;c<a.length;c++)b+=("0"+a.charCodeAt(c).toString(16)).slice(-2);return b}function hextob64(a){return hex2b64(a)}function hextob64nl(a){var b=hextob64(a),c=b.replace(/(.{64})/g,"$1\r\n");return c=c.replace(/\r\n$/,"")}function b64nltohex(a){var b=a.replace(/[^0-9A-Za-z\/+=]*/g,""),c=b64tohex(b);return c}function uricmptohex(a){return a.replace(/%/g,"")}function hextouricmp(a){return a.replace(/(..)/g,"%$1")}function encodeURIComponentAll(a){for(var b=encodeURIComponent(a),c="",d=0;d<b.length;d++)"%"==b[d]?(c+=b.substr(d,3),d+=2):c=c+"%"+stohex(b[d]);return c}function newline_toUnix(a){return a=a.replace(/\r\n/gm,"\n")}function newline_toDos(a){return a=a.replace(/\r\n/gm,"\n"),a=a.replace(/\n/gm,"\r\n")}function intarystrtohex(a){a=a.replace(/^\s*\[\s*/,""),a=a.replace(/\s*\]\s*$/,""),a=a.replace(/\s*/g,"");try{var b=a.split(/,/).map(function(a,b,c){var d=parseInt(a);if(d<0||255<d)throw"integer not in range 0-255";var e=("00"+d.toString(16)).slice(-2);return e}).join("");return b}catch(a){throw"malformed integer array string: "+a}}function parseBigInt(a,b){return new BigInteger(a,b)}function linebrk(a,b){for(var c="",d=0;d+b<a.length;)c+=a.substring(d,d+b)+"\n",d+=b;return c+a.substring(d,a.length)}function byte2Hex(a){return a<16?"0"+a.toString(16):a.toString(16)}function pkcs1pad2(a,b){if(b<a.length+11)return alert("Message too long for RSA"),null;for(var c=new Array,d=a.length-1;d>=0&&b>0;){var e=a.charCodeAt(d--);e<128?c[--b]=e:e>127&&e<2048?(c[--b]=63&e|128,c[--b]=e>>6|192):(c[--b]=63&e|128,c[--b]=e>>6&63|128,c[--b]=e>>12|224)}c[--b]=0;for(var f=new SecureRandom,g=new Array;b>2;){for(g[0]=0;0==g[0];)f.nextBytes(g);c[--b]=g[0]}return c[--b]=2,c[--b]=0,new BigInteger(c)}function oaep_mgf1_arr(a,b,c){for(var d="",e=0;d.length<b;)d+=c(String.fromCharCode.apply(String,a.concat([(4278190080&e)>>24,(16711680&e)>>16,(65280&e)>>8,255&e]))),e+=1;return d}function oaep_pad(a,b,c,d){if(c||(c=rstr_sha1,d=20),a.length+2*d+2>b)throw"Message too long for RSA";var e,f="";for(e=0;e<b-a.length-2*d-2;e+=1)f+="\0";var g=c("")+f+""+a,h=new Array(d);(new SecureRandom).nextBytes(h);var i=oaep_mgf1_arr(h,g.length,c),j=[];for(e=0;e<g.length;e+=1)j[e]=g.charCodeAt(e)^i.charCodeAt(e);var k=oaep_mgf1_arr(j,h.length,c),l=[0];for(e=0;e<h.length;e+=1)l[e+1]=h[e]^k.charCodeAt(e);return new BigInteger(l.concat(j))}function RSAKey(){this.n=null,this.e=0,this.d=null,this.p=null,this.q=null,this.dmp1=null,this.dmq1=null,this.coeff=null}function RSASetPublic(a,b){this.isPublic=!0,"string"!=typeof a?(this.n=a,this.e=b):null!=a&&null!=b&&a.length>0&&b.length>0?(this.n=parseBigInt(a,16),this.e=parseInt(b,16)):alert("Invalid RSA public key")}function RSADoPublic(a){return a.modPowInt(this.e,this.n)}function RSAEncrypt(a){var b=pkcs1pad2(a,this.n.bitLength()+7>>3);if(null==b)return null;var c=this.doPublic(b);if(null==c)return null;var d=c.toString(16);return 0==(1&d.length)?d:"0"+d}function RSAEncryptOAEP(a,b,c){var d=oaep_pad(a,this.n.bitLength()+7>>3,b,c);if(null==d)return null;var e=this.doPublic(d);if(null==e)return null;var f=e.toString(16);return 0==(1&f.length)?f:"0"+f}function _rsasign_getHexPaddedDigestInfoForString(a,b,c){var d=function(a){return KJUR.crypto.Util.hashString(a,c)},e=d(a);return KJUR.crypto.Util.getPaddedDigestInfoHex(e,c,b)}function _zeroPaddingOfSignature(a,b){for(var c="",d=b/4-a.length,e=0;e<d;e++)c+="0";return c+a}function _rsasign_signString(a,b){var c=function(a){return KJUR.crypto.Util.hashString(a,b)},d=c(a);return this.signWithMessageHash(d,b)}function _rsasign_signWithMessageHash(a,b){var c=KJUR.crypto.Util.getPaddedDigestInfoHex(a,b,this.n.bitLength()),d=parseBigInt(c,16),e=this.doPrivate(d),f=e.toString(16);return _zeroPaddingOfSignature(f,this.n.bitLength())}function _rsasign_signStringWithSHA1(a){return _rsasign_signString.call(this,a,"sha1")}function _rsasign_signStringWithSHA256(a){return _rsasign_signString.call(this,a,"sha256")}function pss_mgf1_str(a,b,c){for(var d="",e=0;d.length<b;)d+=hextorstr(c(rstrtohex(a+String.fromCharCode.apply(String,[(4278190080&e)>>24,(16711680&e)>>16,(65280&e)>>8,255&e])))),e+=1;return d}function _rsasign_signStringPSS(a,b,c){var d=function(a){return KJUR.crypto.Util.hashHex(a,b)},e=d(rstrtohex(a));return void 0===c&&(c=-1),this.signWithMessageHashPSS(e,b,c)}function _rsasign_signWithMessageHashPSS(a,b,c){var d,e=hextorstr(a),f=e.length,g=this.n.bitLength()-1,h=Math.ceil(g/8),i=function(a){return KJUR.crypto.Util.hashHex(a,b)};if(c===-1||void 0===c)c=f;else if(c===-2)c=h-f-2;else if(c<-2)throw"invalid salt length";if(h<f+c+2)throw"data too long";var j="";c>0&&(j=new Array(c),(new SecureRandom).nextBytes(j),j=String.fromCharCode.apply(String,j));var k=hextorstr(i(rstrtohex("\0\0\0\0\0\0\0\0"+e+j))),l=[];for(d=0;d<h-c-f-2;d+=1)l[d]=0;var m=String.fromCharCode.apply(String,l)+""+j,n=pss_mgf1_str(k,m.length,i),o=[];for(d=0;d<m.length;d+=1)o[d]=m.charCodeAt(d)^n.charCodeAt(d);var p=65280>>8*h-g&255;for(o[0]&=~p,d=0;d<f;d++)o.push(k.charCodeAt(d));return o.push(188),_zeroPaddingOfSignature(this.doPrivate(new BigInteger(o)).toString(16),this.n.bitLength())}function _rsasign_getDecryptSignatureBI(a,b,c){var d=new RSAKey;d.setPublic(b,c);var e=d.doPublic(a);return e}function _rsasign_getHexDigestInfoFromSig(a,b,c){var d=_rsasign_getDecryptSignatureBI(a,b,c),e=d.toString(16).replace(/^1f+00/,"");return e}function _rsasign_getAlgNameAndHashFromHexDisgestInfo(a){for(var b in KJUR.crypto.Util.DIGESTINFOHEAD){var c=KJUR.crypto.Util.DIGESTINFOHEAD[b],d=c.length;if(a.substring(0,d)==c){var e=[b,a.substring(d)];return e}}return[]}function _rsasign_verifySignatureWithArgs(a,b,c,d){var e=_rsasign_getHexDigestInfoFromSig(b,c,d),f=_rsasign_getAlgNameAndHashFromHexDisgestInfo(e);if(0==f.length)return!1;var g=f[0],h=f[1],i=function(a){return KJUR.crypto.Util.hashString(a,g)},j=i(a);return h==j}function _rsasign_verifyHexSignatureForMessage(a,b){var c=parseBigInt(a,16),d=_rsasign_verifySignatureWithArgs(b,c,this.n.toString(16),this.e.toString(16));return d}function _rsasign_verifyString(a,b){b=b.replace(_RE_HEXDECONLY,""),b=b.replace(/[ \n]+/g,"");var c=parseBigInt(b,16);if(c.bitLength()>this.n.bitLength())return 0;var d=this.doPublic(c),e=d.toString(16).replace(/^1f+00/,""),f=_rsasign_getAlgNameAndHashFromHexDisgestInfo(e);if(0==f.length)return!1;var g=f[0],h=f[1],i=function(a){return KJUR.crypto.Util.hashString(a,g)},j=i(a);return h==j}function _rsasign_verifyWithMessageHash(a,b){b=b.replace(_RE_HEXDECONLY,""),b=b.replace(/[ \n]+/g,"");var c=parseBigInt(b,16);if(c.bitLength()>this.n.bitLength())return 0;var d=this.doPublic(c),e=d.toString(16).replace(/^1f+00/,""),f=_rsasign_getAlgNameAndHashFromHexDisgestInfo(e);if(0==f.length)return!1;var g=(f[0],f[1]);return g==a}function _rsasign_verifyStringPSS(a,b,c,d){var e=function(a){return KJUR.crypto.Util.hashHex(a,c)},f=e(rstrtohex(a));return void 0===d&&(d=-1),this.verifyWithMessageHashPSS(f,b,c,d)}function _rsasign_verifyWithMessageHashPSS(a,b,c,d){var e=new BigInteger(b,16);if(e.bitLength()>this.n.bitLength())return!1;var f,g=function(a){return KJUR.crypto.Util.hashHex(a,c)},h=hextorstr(a),i=h.length,j=this.n.bitLength()-1,k=Math.ceil(j/8);if(d===-1||void 0===d)d=i;else if(d===-2)d=k-i-2;else if(d<-2)throw"invalid salt length";if(k<i+d+2)throw"data too long";var l=this.doPublic(e).toByteArray();for(f=0;f<l.length;f+=1)l[f]&=255;for(;l.length<k;)l.unshift(0);if(188!==l[k-1])throw"encoded message does not end in 0xbc";l=String.fromCharCode.apply(String,l);var m=l.substr(0,k-i-1),n=l.substr(m.length,i),o=65280>>8*k-j&255;if(0!==(m.charCodeAt(0)&o))throw"bits beyond keysize not zero";var p=pss_mgf1_str(n,m.length,g),q=[];for(f=0;f<m.length;f+=1)q[f]=m.charCodeAt(f)^p.charCodeAt(f);q[0]&=~o;var r=k-i-d-2;for(f=0;f<r;f+=1)if(0!==q[f])throw"leftmost octets not zero";if(1!==q[r])throw"0x01 marker not found";return n===hextorstr(g(rstrtohex("\0\0\0\0\0\0\0\0"+h+String.fromCharCode.apply(String,q.slice(-d)))))}!function(a,b){"use strict";"object"==typeof module&&module.exports?module.exports=b(require("./punycode"),require("./IPv6"),require("./SecondLevelDomains")):"function"==typeof define&&define.amd?define(["./punycode","./IPv6","./SecondLevelDomains"],b):a.URI=b(a.punycode,a.IPv6,a.SecondLevelDomains,a)}(this,function(a,b,c,d){"use strict";function e(a,b){var c=arguments.length>=1,d=arguments.length>=2;if(!(this instanceof e))return c?d?new e(a,b):new e(a):new e;if(void 0===a){if(c)throw new TypeError("undefined is not a valid argument for URI");a="undefined"!=typeof location?location.href+"":""}if(null===a&&c)throw new TypeError("null is not a valid argument for URI");return this.href(a),void 0!==b?this.absoluteTo(b):this}function f(a){return/^[0-9]+$/.test(a)}function g(a){return a.replace(/([.*+?^=!:${}()|[\]\/\\])/g,"\\$1")}function h(a){return void 0===a?"Undefined":String(Object.prototype.toString.call(a)).slice(8,-1)}function i(a){return"Array"===h(a)}function j(a,b){var c,d,e={};if("RegExp"===h(b))e=null;else if(i(b))for(c=0,d=b.length;c<d;c++)e[b[c]]=!0;else e[b]=!0;for(c=0,d=a.length;c<d;c++){var f=e&&void 0!==e[a[c]]||!e&&b.test(a[c]);f&&(a.splice(c,1),d--,c--)}return a}function k(a,b){var c,d;if(i(b)){for(c=0,d=b.length;c<d;c++)if(!k(a,b[c]))return!1;return!0}var e=h(b);for(c=0,d=a.length;c<d;c++)if("RegExp"===e){if("string"==typeof a[c]&&a[c].match(b))return!0}else if(a[c]===b)return!0;return!1}function l(a,b){if(!i(a)||!i(b))return!1;if(a.length!==b.length)return!1;a.sort(),b.sort();for(var c=0,d=a.length;c<d;c++)if(a[c]!==b[c])return!1;return!0}function m(a){var b=/^\/+|\/+$/g;return a.replace(b,"")}function n(a){return escape(a)}function o(a){return encodeURIComponent(a).replace(/[!'()*]/g,n).replace(/\*/g,"%2A")}function p(a){return function(b,c){return void 0===b?this._parts[a]||"":(this._parts[a]=b||null,this.build(!c),this)}}function q(a,b){return function(c,d){return void 0===c?this._parts[a]||"":(null!==c&&(c+="",c.charAt(0)===b&&(c=c.substring(1))),this._parts[a]=c,this.build(!d),this)}}var r=d&&d.URI;e.version="1.18.12";var s=e.prototype,t=Object.prototype.hasOwnProperty;e._parts=function(){return{protocol:null,username:null,password:null,hostname:null,urn:null,port:null,path:null,query:null,fragment:null,duplicateQueryParameters:e.duplicateQueryParameters,escapeQuerySpace:e.escapeQuerySpace}},e.duplicateQueryParameters=!1,e.escapeQuerySpace=!0,e.protocol_expression=/^[a-z][a-z0-9.+-]*$/i,e.idn_expression=/[^a-z0-9\._-]/i,e.punycode_expression=/(xn--)/i,e.ip4_expression=/^\d{1,3}\.\d{1,3}\.\d{1,3}\.\d{1,3}$/,e.ip6_expression=/^\s*((([0-9A-Fa-f]{1,4}:){7}([0-9A-Fa-f]{1,4}|:))|(([0-9A-Fa-f]{1,4}:){6}(:[0-9A-Fa-f]{1,4}|((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3})|:))|(([0-9A-Fa-f]{1,4}:){5}(((:[0-9A-Fa-f]{1,4}){1,2})|:((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3})|:))|(([0-9A-Fa-f]{1,4}:){4}(((:[0-9A-Fa-f]{1,4}){1,3})|((:[0-9A-Fa-f]{1,4})?:((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:))|(([0-9A-Fa-f]{1,4}:){3}(((:[0-9A-Fa-f]{1,4}){1,4})|((:[0-9A-Fa-f]{1,4}){0,2}:((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:))|(([0-9A-Fa-f]{1,4}:){2}(((:[0-9A-Fa-f]{1,4}){1,5})|((:[0-9A-Fa-f]{1,4}){0,3}:((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:))|(([0-9A-Fa-f]{1,4}:){1}(((:[0-9A-Fa-f]{1,4}){1,6})|((:[0-9A-Fa-f]{1,4}){0,4}:((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:))|(:(((:[0-9A-Fa-f]{1,4}){1,7})|((:[0-9A-Fa-f]{1,4}){0,5}:((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:)))(%.+)?\s*$/,e.find_uri_expression=/\b((?:[a-z][\w-]+:(?:\/{1,3}|[a-z0-9%])|www\d{0,3}[.]|[a-z0-9.\-]+[.][a-z]{2,4}\/)(?:[^\s()<>]+|\(([^\s()<>]+|(\([^\s()<>]+\)))*\))+(?:\(([^\s()<>]+|(\([^\s()<>]+\)))*\)|[^\s`!()\[\]{};:'".,<>?«»“”‘’]))/gi,e.findUri={start:/\b(?:([a-z][a-z0-9.+-]*:\/\/)|www\.)/gi,end:/[\s\r\n]|$/,trim:/[`!()\[\]{};:'".,<>?«»“”„‘’]+$/,parens:/(\([^\)]*\)|\[[^\]]*\]|\{[^}]*\}|<[^>]*>)/g},e.defaultPorts={http:"80",https:"443",ftp:"21",gopher:"70",ws:"80",wss:"443"},e.hostProtocols=["http","https"],e.invalid_hostname_characters=/[^a-zA-Z0-9\.\-:_]/,e.domAttributes={a:"href",blockquote:"cite",link:"href",base:"href",script:"src",form:"action",img:"src",area:"href",iframe:"src",embed:"src",source:"src",track:"src",input:"src",audio:"src",video:"src"},e.getDomAttribute=function(a){if(a&&a.nodeName){var b=a.nodeName.toLowerCase();if("input"!==b||"image"===a.type)return e.domAttributes[b]}},e.encode=o,e.decode=decodeURIComponent,e.iso8859=function(){e.encode=escape,e.decode=unescape},e.unicode=function(){e.encode=o,e.decode=decodeURIComponent},e.characters={pathname:{encode:{expression:/%(24|26|2B|2C|3B|3D|3A|40)/gi,map:{"%24":"$","%26":"&","%2B":"+","%2C":",","%3B":";","%3D":"=","%3A":":","%40":"@"}},decode:{expression:/[\/\?#]/g,map:{"/":"%2F","?":"%3F","#":"%23"}}},reserved:{encode:{expression:/%(21|23|24|26|27|28|29|2A|2B|2C|2F|3A|3B|3D|3F|40|5B|5D)/gi,map:{"%3A":":","%2F":"/","%3F":"?","%23":"#","%5B":"[","%5D":"]","%40":"@","%21":"!","%24":"$","%26":"&","%27":"'","%28":"(","%29":")","%2A":"*","%2B":"+","%2C":",","%3B":";","%3D":"="}}},urnpath:{encode:{expression:/%(21|24|27|28|29|2A|2B|2C|3B|3D|40)/gi,map:{"%21":"!","%24":"$","%27":"'","%28":"(","%29":")","%2A":"*","%2B":"+","%2C":",","%3B":";","%3D":"=","%40":"@"}},decode:{expression:/[\/\?#:]/g,map:{"/":"%2F","?":"%3F","#":"%23",":":"%3A"}}}},e.encodeQuery=function(a,b){var c=e.encode(a+"");return void 0===b&&(b=e.escapeQuerySpace),b?c.replace(/%20/g,"+"):c},e.decodeQuery=function(a,b){a+="",void 0===b&&(b=e.escapeQuerySpace);try{return e.decode(b?a.replace(/\+/g,"%20"):a)}catch(b){return a}};var u,v={encode:"encode",decode:"decode"},w=function(a,b){return function(c){try{return e[b](c+"").replace(e.characters[a][b].expression,function(c){return e.characters[a][b].map[c]})}catch(a){return c}}};for(u in v)e[u+"PathSegment"]=w("pathname",v[u]),e[u+"UrnPathSegment"]=w("urnpath",v[u]);var x=function(a,b,c){return function(d){var f;f=c?function(a){return e[b](e[c](a))}:e[b];for(var g=(d+"").split(a),h=0,i=g.length;h<i;h++)g[h]=f(g[h]);return g.join(a)}};e.decodePath=x("/","decodePathSegment"),e.decodeUrnPath=x(":","decodeUrnPathSegment"),e.recodePath=x("/","encodePathSegment","decode"),e.recodeUrnPath=x(":","encodeUrnPathSegment","decode"),e.encodeReserved=w("reserved","encode"),e.parse=function(a,b){var c;return b||(b={}),c=a.indexOf("#"),c>-1&&(b.fragment=a.substring(c+1)||null,a=a.substring(0,c)),c=a.indexOf("?"),c>-1&&(b.query=a.substring(c+1)||null,a=a.substring(0,c)),"//"===a.substring(0,2)?(b.protocol=null,a=a.substring(2),a=e.parseAuthority(a,b)):(c=a.indexOf(":"),c>-1&&(b.protocol=a.substring(0,c)||null,b.protocol&&!b.protocol.match(e.protocol_expression)?b.protocol=void 0:"//"===a.substring(c+1,c+3)?(a=a.substring(c+3),a=e.parseAuthority(a,b)):(a=a.substring(c+1),b.urn=!0))),b.path=a,b},e.parseHost=function(a,b){a=a.replace(/\\/g,"/");var c,d,f=a.indexOf("/");if(f===-1&&(f=a.length),"["===a.charAt(0))c=a.indexOf("]"),b.hostname=a.substring(1,c)||null,b.port=a.substring(c+2,f)||null,"/"===b.port&&(b.port=null);else{var g=a.indexOf(":"),h=a.indexOf("/"),i=a.indexOf(":",g+1);i!==-1&&(h===-1||i<h)?(b.hostname=a.substring(0,f)||null,b.port=null):(d=a.substring(0,f).split(":"),b.hostname=d[0]||null,b.port=d[1]||null)}return b.hostname&&"/"!==a.substring(f).charAt(0)&&(f++,a="/"+a),e.ensureValidHostname(b.hostname,b.protocol),b.port&&e.ensureValidPort(b.port),a.substring(f)||"/"},e.parseAuthority=function(a,b){return a=e.parseUserinfo(a,b),e.parseHost(a,b)},e.parseUserinfo=function(a,b){var c,d=a.indexOf("/"),f=a.lastIndexOf("@",d>-1?d:a.length-1);return f>-1&&(d===-1||f<d)?(c=a.substring(0,f).split(":"),b.username=c[0]?e.decode(c[0]):null,c.shift(),b.password=c[0]?e.decode(c.join(":")):null,a=a.substring(f+1)):(b.username=null,b.password=null),a},e.parseQuery=function(a,b){if(!a)return{};if(a=a.replace(/&+/g,"&").replace(/^\?*&*|&+$/g,""),!a)return{};for(var c,d,f,g={},h=a.split("&"),i=h.length,j=0;j<i;j++)c=h[j].split("="),d=e.decodeQuery(c.shift(),b),f=c.length?e.decodeQuery(c.join("="),b):null,t.call(g,d)?("string"!=typeof g[d]&&null!==g[d]||(g[d]=[g[d]]),g[d].push(f)):g[d]=f;return g},e.build=function(a){var b="";return a.protocol&&(b+=a.protocol+":"),a.urn||!b&&!a.hostname||(b+="//"),b+=e.buildAuthority(a)||"","string"==typeof a.path&&("/"!==a.path.charAt(0)&&"string"==typeof a.hostname&&(b+="/"),b+=a.path),"string"==typeof a.query&&a.query&&(b+="?"+a.query),"string"==typeof a.fragment&&a.fragment&&(b+="#"+a.fragment),b},e.buildHost=function(a){var b="";return a.hostname?(b+=e.ip6_expression.test(a.hostname)?"["+a.hostname+"]":a.hostname,a.port&&(b+=":"+a.port),b):""},e.buildAuthority=function(a){return e.buildUserinfo(a)+e.buildHost(a)},e.buildUserinfo=function(a){var b="";return a.username&&(b+=e.encode(a.username)),a.password&&(b+=":"+e.encode(a.password)),b&&(b+="@"),b},e.buildQuery=function(a,b,c){var d,f,g,h,j="";for(f in a)if(t.call(a,f)&&f)if(i(a[f]))for(d={},g=0,h=a[f].length;g<h;g++)void 0!==a[f][g]&&void 0===d[a[f][g]+""]&&(j+="&"+e.buildQueryParameter(f,a[f][g],c),b!==!0&&(d[a[f][g]+""]=!0));else void 0!==a[f]&&(j+="&"+e.buildQueryParameter(f,a[f],c));return j.substring(1)},e.buildQueryParameter=function(a,b,c){return e.encodeQuery(a,c)+(null!==b?"="+e.encodeQuery(b,c):"")},e.addQuery=function(a,b,c){if("object"==typeof b)for(var d in b)t.call(b,d)&&e.addQuery(a,d,b[d]);else{if("string"!=typeof b)throw new TypeError("URI.addQuery() accepts an object, string as the name parameter");if(void 0===a[b])return void(a[b]=c);"string"==typeof a[b]&&(a[b]=[a[b]]),i(c)||(c=[c]),a[b]=(a[b]||[]).concat(c)}},e.removeQuery=function(a,b,c){var d,f,g;if(i(b))for(d=0,f=b.length;d<f;d++)a[b[d]]=void 0;else if("RegExp"===h(b))for(g in a)b.test(g)&&(a[g]=void 0);else if("object"==typeof b)for(g in b)t.call(b,g)&&e.removeQuery(a,g,b[g]);else{if("string"!=typeof b)throw new TypeError("URI.removeQuery() accepts an object, string, RegExp as the first parameter");void 0!==c?"RegExp"===h(c)?!i(a[b])&&c.test(a[b])?a[b]=void 0:a[b]=j(a[b],c):a[b]!==String(c)||i(c)&&1!==c.length?i(a[b])&&(a[b]=j(a[b],c)):a[b]=void 0:a[b]=void 0}},e.hasQuery=function(a,b,c,d){switch(h(b)){case"String":break;case"RegExp":for(var f in a)if(t.call(a,f)&&b.test(f)&&(void 0===c||e.hasQuery(a,f,c)))return!0;return!1;case"Object":for(var g in b)if(t.call(b,g)&&!e.hasQuery(a,g,b[g]))return!1;return!0;default:throw new TypeError("URI.hasQuery() accepts a string, regular expression or object as the name parameter")}switch(h(c)){case"Undefined":return b in a;case"Boolean":var j=Boolean(i(a[b])?a[b].length:a[b]);return c===j;case"Function":return!!c(a[b],b,a);case"Array":if(!i(a[b]))return!1;var m=d?k:l;return m(a[b],c);case"RegExp":return i(a[b])?!!d&&k(a[b],c):Boolean(a[b]&&a[b].match(c));case"Number":c=String(c);case"String":return i(a[b])?!!d&&k(a[b],c):a[b]===c;default:throw new TypeError("URI.hasQuery() accepts undefined, boolean, string, number, RegExp, Function as the value parameter")}},e.joinPaths=function(){for(var a=[],b=[],c=0,d=0;d<arguments.length;d++){var f=new e(arguments[d]);a.push(f);for(var g=f.segment(),h=0;h<g.length;h++)"string"==typeof g[h]&&b.push(g[h]),g[h]&&c++}if(!b.length||!c)return new e("");var i=new e("").segment(b);return""!==a[0].path()&&"/"!==a[0].path().slice(0,1)||i.path("/"+i.path()),i.normalize()},e.commonPath=function(a,b){var c,d=Math.min(a.length,b.length);for(c=0;c<d;c++)if(a.charAt(c)!==b.charAt(c)){c--;break}return c<1?a.charAt(0)===b.charAt(0)&&"/"===a.charAt(0)?"/":"":("/"===a.charAt(c)&&"/"===b.charAt(c)||(c=a.substring(0,c).lastIndexOf("/")),a.substring(0,c+1))},e.withinString=function(a,b,c){c||(c={});var d=c.start||e.findUri.start,f=c.end||e.findUri.end,g=c.trim||e.findUri.trim,h=c.parens||e.findUri.parens,i=/[a-z0-9-]=["']?$/i;for(d.lastIndex=0;;){var j=d.exec(a);if(!j)break;var k=j.index;if(c.ignoreHtml){var l=a.slice(Math.max(k-3,0),k);if(l&&i.test(l))continue}for(var m=k+a.slice(k).search(f),n=a.slice(k,m),o=-1;;){var p=h.exec(n);if(!p)break;var q=p.index+p[0].length;o=Math.max(o,q)}if(n=o>-1?n.slice(0,o)+n.slice(o).replace(g,""):n.replace(g,""),!(n.length<=j[0].length||c.ignore&&c.ignore.test(n))){m=k+n.length;var r=b(n,k,m,a);void 0!==r?(r=String(r),a=a.slice(0,k)+r+a.slice(m),d.lastIndex=k+r.length):d.lastIndex=m}}return d.lastIndex=0,a},e.ensureValidHostname=function(b,c){var d=!!b,f=!!c,g=!1;if(f&&(g=k(e.hostProtocols,c)),g&&!d)throw new TypeError("Hostname cannot be empty, if protocol is "+c);if(b&&b.match(e.invalid_hostname_characters)){if(!a)throw new TypeError('Hostname "'+b+'" contains characters other than [A-Z0-9.-:_] and Punycode.js is not available');if(a.toASCII(b).match(e.invalid_hostname_characters))throw new TypeError('Hostname "'+b+'" contains characters other than [A-Z0-9.-:_]')}},e.ensureValidPort=function(a){if(a){var b=Number(a);if(!(f(b)&&b>0&&b<65536))throw new TypeError('Port "'+a+'" is not a valid port')}},e.noConflict=function(a){if(a){var b={URI:this.noConflict()};return d.URITemplate&&"function"==typeof d.URITemplate.noConflict&&(b.URITemplate=d.URITemplate.noConflict()),d.IPv6&&"function"==typeof d.IPv6.noConflict&&(b.IPv6=d.IPv6.noConflict()),d.SecondLevelDomains&&"function"==typeof d.SecondLevelDomains.noConflict&&(b.SecondLevelDomains=d.SecondLevelDomains.noConflict()),b}return d.URI===this&&(d.URI=r),this},s.build=function(a){return a===!0?this._deferred_build=!0:(void 0===a||this._deferred_build)&&(this._string=e.build(this._parts),this._deferred_build=!1),this},s.clone=function(){return new e(this)},s.valueOf=s.toString=function(){return this.build(!1)._string},s.protocol=p("protocol"),s.username=p("username"),s.password=p("password"),s.hostname=p("hostname"),s.port=p("port"),s.query=q("query","?"),s.fragment=q("fragment","#"),s.search=function(a,b){var c=this.query(a,b);return"string"==typeof c&&c.length?"?"+c:c},s.hash=function(a,b){var c=this.fragment(a,b);return"string"==typeof c&&c.length?"#"+c:c},s.pathname=function(a,b){if(void 0===a||a===!0){var c=this._parts.path||(this._parts.hostname?"/":"");return a?(this._parts.urn?e.decodeUrnPath:e.decodePath)(c):c}return this._parts.urn?this._parts.path=a?e.recodeUrnPath(a):"":this._parts.path=a?e.recodePath(a):"/",this.build(!b),this},s.path=s.pathname,s.href=function(a,b){var c;if(void 0===a)return this.toString();this._string="",this._parts=e._parts();var d=a instanceof e,f="object"==typeof a&&(a.hostname||a.path||a.pathname);if(a.nodeName){var g=e.getDomAttribute(a);a=a[g]||"",f=!1}if(!d&&f&&void 0!==a.pathname&&(a=a.toString()),"string"==typeof a||a instanceof String)this._parts=e.parse(String(a),this._parts);else{if(!d&&!f)throw new TypeError("invalid input");var h=d?a._parts:a;for(c in h)t.call(this._parts,c)&&(this._parts[c]=h[c])}return this.build(!b),this},s.is=function(a){var b=!1,d=!1,f=!1,g=!1,h=!1,i=!1,j=!1,k=!this._parts.urn;switch(this._parts.hostname&&(k=!1,d=e.ip4_expression.test(this._parts.hostname),f=e.ip6_expression.test(this._parts.hostname),b=d||f,g=!b,h=g&&c&&c.has(this._parts.hostname),i=g&&e.idn_expression.test(this._parts.hostname),j=g&&e.punycode_expression.test(this._parts.hostname)),a.toLowerCase()){case"relative":return k;case"absolute":return!k;case"domain":case"name":return g;case"sld":return h;case"ip":return b;case"ip4":case"ipv4":case"inet4":return d;case"ip6":case"ipv6":case"inet6":return f;case"idn":return i;case"url":return!this._parts.urn;case"urn":return!!this._parts.urn;case"punycode":return j}return null};var y=s.protocol,z=s.port,A=s.hostname;s.protocol=function(a,b){if(void 0!==a&&a&&(a=a.replace(/:(\/\/)?$/,""),!a.match(e.protocol_expression)))throw new TypeError('Protocol "'+a+"\" contains characters other than [A-Z0-9.+-] or doesn't start with [A-Z]");return y.call(this,a,b)},s.scheme=s.protocol,s.port=function(a,b){return this._parts.urn?void 0===a?"":this:(void 0!==a&&(0===a&&(a=null),a&&(a+="",":"===a.charAt(0)&&(a=a.substring(1)),e.ensureValidPort(a))),z.call(this,a,b))},s.hostname=function(a,b){if(this._parts.urn)return void 0===a?"":this;if(void 0!==a){var c={},d=e.parseHost(a,c);if("/"!==d)throw new TypeError('Hostname "'+a+'" contains characters other than [A-Z0-9.-]');a=c.hostname,e.ensureValidHostname(a,this._parts.protocol)}return A.call(this,a,b)},s.origin=function(a,b){if(this._parts.urn)return void 0===a?"":this;if(void 0===a){var c=this.protocol(),d=this.authority();return d?(c?c+"://":"")+this.authority():""}var f=e(a);return this.protocol(f.protocol()).authority(f.authority()).build(!b),this},s.host=function(a,b){if(this._parts.urn)return void 0===a?"":this;if(void 0===a)return this._parts.hostname?e.buildHost(this._parts):"";var c=e.parseHost(a,this._parts);if("/"!==c)throw new TypeError('Hostname "'+a+'" contains characters other than [A-Z0-9.-]');return this.build(!b),this},s.authority=function(a,b){if(this._parts.urn)return void 0===a?"":this;if(void 0===a)return this._parts.hostname?e.buildAuthority(this._parts):"";var c=e.parseAuthority(a,this._parts);if("/"!==c)throw new TypeError('Hostname "'+a+'" contains characters other than [A-Z0-9.-]');return this.build(!b),this},s.userinfo=function(a,b){if(this._parts.urn)return void 0===a?"":this;if(void 0===a){var c=e.buildUserinfo(this._parts);return c?c.substring(0,c.length-1):c}return"@"!==a[a.length-1]&&(a+="@"),e.parseUserinfo(a,this._parts),this.build(!b),this},s.resource=function(a,b){var c;return void 0===a?this.path()+this.search()+this.hash():(c=e.parse(a),this._parts.path=c.path,this._parts.query=c.query,this._parts.fragment=c.fragment,this.build(!b),this)},s.subdomain=function(a,b){if(this._parts.urn)return void 0===a?"":this;if(void 0===a){if(!this._parts.hostname||this.is("IP"))return"";var c=this._parts.hostname.length-this.domain().length-1;return this._parts.hostname.substring(0,c)||""}var d=this._parts.hostname.length-this.domain().length,f=this._parts.hostname.substring(0,d),h=new RegExp("^"+g(f));if(a&&"."!==a.charAt(a.length-1)&&(a+="."),a.indexOf(":")!==-1)throw new TypeError("Domains cannot contain colons");return a&&e.ensureValidHostname(a,this._parts.protocol),this._parts.hostname=this._parts.hostname.replace(h,a),this.build(!b),this},s.domain=function(a,b){if(this._parts.urn)return void 0===a?"":this;if("boolean"==typeof a&&(b=a,a=void 0),void 0===a){if(!this._parts.hostname||this.is("IP"))return"";var c=this._parts.hostname.match(/\./g);if(c&&c.length<2)return this._parts.hostname;var d=this._parts.hostname.length-this.tld(b).length-1;return d=this._parts.hostname.lastIndexOf(".",d-1)+1,this._parts.hostname.substring(d)||""}if(!a)throw new TypeError("cannot set domain empty");if(a.indexOf(":")!==-1)throw new TypeError("Domains cannot contain colons");if(e.ensureValidHostname(a,this._parts.protocol),!this._parts.hostname||this.is("IP"))this._parts.hostname=a;else{var f=new RegExp(g(this.domain())+"$");this._parts.hostname=this._parts.hostname.replace(f,a)}return this.build(!b),this},s.tld=function(a,b){if(this._parts.urn)return void 0===a?"":this;if("boolean"==typeof a&&(b=a,a=void 0),void 0===a){if(!this._parts.hostname||this.is("IP"))return"";var d=this._parts.hostname.lastIndexOf("."),e=this._parts.hostname.substring(d+1);return b!==!0&&c&&c.list[e.toLowerCase()]?c.get(this._parts.hostname)||e:e}var f;if(!a)throw new TypeError("cannot set TLD empty");if(a.match(/[^a-zA-Z0-9-]/)){if(!c||!c.is(a))throw new TypeError('TLD "'+a+'" contains characters other than [A-Z0-9]');f=new RegExp(g(this.tld())+"$"),this._parts.hostname=this._parts.hostname.replace(f,a)}else{if(!this._parts.hostname||this.is("IP"))throw new ReferenceError("cannot set TLD on non-domain host");f=new RegExp(g(this.tld())+"$"),this._parts.hostname=this._parts.hostname.replace(f,a)}return this.build(!b),this},s.directory=function(a,b){if(this._parts.urn)return void 0===a?"":this;if(void 0===a||a===!0){if(!this._parts.path&&!this._parts.hostname)return"";if("/"===this._parts.path)return"/";var c=this._parts.path.length-this.filename().length-1,d=this._parts.path.substring(0,c)||(this._parts.hostname?"/":"");return a?e.decodePath(d):d}var f=this._parts.path.length-this.filename().length,h=this._parts.path.substring(0,f),i=new RegExp("^"+g(h));return this.is("relative")||(a||(a="/"),"/"!==a.charAt(0)&&(a="/"+a)),a&&"/"!==a.charAt(a.length-1)&&(a+="/"),a=e.recodePath(a),this._parts.path=this._parts.path.replace(i,a),this.build(!b),this},s.filename=function(a,b){if(this._parts.urn)return void 0===a?"":this;if("string"!=typeof a){if(!this._parts.path||"/"===this._parts.path)return"";var c=this._parts.path.lastIndexOf("/"),d=this._parts.path.substring(c+1);return a?e.decodePathSegment(d):d}var f=!1;"/"===a.charAt(0)&&(a=a.substring(1)),a.match(/\.?\//)&&(f=!0);var h=new RegExp(g(this.filename())+"$");return a=e.recodePath(a),this._parts.path=this._parts.path.replace(h,a),f?this.normalizePath(b):this.build(!b),this},s.suffix=function(a,b){if(this._parts.urn)return void 0===a?"":this;if(void 0===a||a===!0){if(!this._parts.path||"/"===this._parts.path)return"";var c,d,f=this.filename(),h=f.lastIndexOf(".");return h===-1?"":(c=f.substring(h+1),d=/^[a-z0-9%]+$/i.test(c)?c:"",a?e.decodePathSegment(d):d)}"."===a.charAt(0)&&(a=a.substring(1));var i,j=this.suffix();if(j)i=a?new RegExp(g(j)+"$"):new RegExp(g("."+j)+"$");else{if(!a)return this;this._parts.path+="."+e.recodePath(a)}return i&&(a=e.recodePath(a),this._parts.path=this._parts.path.replace(i,a)),this.build(!b),this},s.segment=function(a,b,c){var d=this._parts.urn?":":"/",e=this.path(),f="/"===e.substring(0,1),g=e.split(d);if(void 0!==a&&"number"!=typeof a&&(c=b,b=a,a=void 0),void 0!==a&&"number"!=typeof a)throw new Error('Bad segment "'+a+'", must be 0-based integer');if(f&&g.shift(),a<0&&(a=Math.max(g.length+a,0)),void 0===b)return void 0===a?g:g[a];if(null===a||void 0===g[a])if(i(b)){g=[];for(var h=0,j=b.length;h<j;h++)(b[h].length||g.length&&g[g.length-1].length)&&(g.length&&!g[g.length-1].length&&g.pop(),g.push(m(b[h])))}else(b||"string"==typeof b)&&(b=m(b),""===g[g.length-1]?g[g.length-1]=b:g.push(b));else b?g[a]=m(b):g.splice(a,1);return f&&g.unshift(""),this.path(g.join(d),c)},s.segmentCoded=function(a,b,c){var d,f,g;if("number"!=typeof a&&(c=b,b=a,a=void 0),void 0===b){if(d=this.segment(a,b,c),i(d))for(f=0,g=d.length;f<g;f++)d[f]=e.decode(d[f]);else d=void 0!==d?e.decode(d):void 0;return d}if(i(b))for(f=0,g=b.length;f<g;f++)b[f]=e.encode(b[f]);else b="string"==typeof b||b instanceof String?e.encode(b):b;return this.segment(a,b,c)};var B=s.query;return s.query=function(a,b){if(a===!0)return e.parseQuery(this._parts.query,this._parts.escapeQuerySpace);if("function"==typeof a){var c=e.parseQuery(this._parts.query,this._parts.escapeQuerySpace),d=a.call(this,c);
return this._parts.query=e.buildQuery(d||c,this._parts.duplicateQueryParameters,this._parts.escapeQuerySpace),this.build(!b),this}return void 0!==a&&"string"!=typeof a?(this._parts.query=e.buildQuery(a,this._parts.duplicateQueryParameters,this._parts.escapeQuerySpace),this.build(!b),this):B.call(this,a,b)},s.setQuery=function(a,b,c){var d=e.parseQuery(this._parts.query,this._parts.escapeQuerySpace);if("string"==typeof a||a instanceof String)d[a]=void 0!==b?b:null;else{if("object"!=typeof a)throw new TypeError("URI.addQuery() accepts an object, string as the name parameter");for(var f in a)t.call(a,f)&&(d[f]=a[f])}return this._parts.query=e.buildQuery(d,this._parts.duplicateQueryParameters,this._parts.escapeQuerySpace),"string"!=typeof a&&(c=b),this.build(!c),this},s.addQuery=function(a,b,c){var d=e.parseQuery(this._parts.query,this._parts.escapeQuerySpace);return e.addQuery(d,a,void 0===b?null:b),this._parts.query=e.buildQuery(d,this._parts.duplicateQueryParameters,this._parts.escapeQuerySpace),"string"!=typeof a&&(c=b),this.build(!c),this},s.removeQuery=function(a,b,c){var d=e.parseQuery(this._parts.query,this._parts.escapeQuerySpace);return e.removeQuery(d,a,b),this._parts.query=e.buildQuery(d,this._parts.duplicateQueryParameters,this._parts.escapeQuerySpace),"string"!=typeof a&&(c=b),this.build(!c),this},s.hasQuery=function(a,b,c){var d=e.parseQuery(this._parts.query,this._parts.escapeQuerySpace);return e.hasQuery(d,a,b,c)},s.setSearch=s.setQuery,s.addSearch=s.addQuery,s.removeSearch=s.removeQuery,s.hasSearch=s.hasQuery,s.normalize=function(){return this._parts.urn?this.normalizeProtocol(!1).normalizePath(!1).normalizeQuery(!1).normalizeFragment(!1).build():this.normalizeProtocol(!1).normalizeHostname(!1).normalizePort(!1).normalizePath(!1).normalizeQuery(!1).normalizeFragment(!1).build()},s.normalizeProtocol=function(a){return"string"==typeof this._parts.protocol&&(this._parts.protocol=this._parts.protocol.toLowerCase(),this.build(!a)),this},s.normalizeHostname=function(c){return this._parts.hostname&&(this.is("IDN")&&a?this._parts.hostname=a.toASCII(this._parts.hostname):this.is("IPv6")&&b&&(this._parts.hostname=b.best(this._parts.hostname)),this._parts.hostname=this._parts.hostname.toLowerCase(),this.build(!c)),this},s.normalizePort=function(a){return"string"==typeof this._parts.protocol&&this._parts.port===e.defaultPorts[this._parts.protocol]&&(this._parts.port=null,this.build(!a)),this},s.normalizePath=function(a){var b=this._parts.path;if(!b)return this;if(this._parts.urn)return this._parts.path=e.recodeUrnPath(this._parts.path),this.build(!a),this;if("/"===this._parts.path)return this;b=e.recodePath(b);var c,d,f,g="";for("/"!==b.charAt(0)&&(c=!0,b="/"+b),"/.."!==b.slice(-3)&&"/."!==b.slice(-2)||(b+="/"),b=b.replace(/(\/(\.\/)+)|(\/\.$)/g,"/").replace(/\/{2,}/g,"/"),c&&(g=b.substring(1).match(/^(\.\.\/)+/)||"",g&&(g=g[0]));;){if(d=b.search(/\/\.\.(\/|$)/),d===-1)break;0!==d?(f=b.substring(0,d).lastIndexOf("/"),f===-1&&(f=d),b=b.substring(0,f)+b.substring(d+3)):b=b.substring(3)}return c&&this.is("relative")&&(b=g+b.substring(1)),this._parts.path=b,this.build(!a),this},s.normalizePathname=s.normalizePath,s.normalizeQuery=function(a){return"string"==typeof this._parts.query&&(this._parts.query.length?this.query(e.parseQuery(this._parts.query,this._parts.escapeQuerySpace)):this._parts.query=null,this.build(!a)),this},s.normalizeFragment=function(a){return this._parts.fragment||(this._parts.fragment=null,this.build(!a)),this},s.normalizeSearch=s.normalizeQuery,s.normalizeHash=s.normalizeFragment,s.iso8859=function(){var a=e.encode,b=e.decode;e.encode=escape,e.decode=decodeURIComponent;try{this.normalize()}finally{e.encode=a,e.decode=b}return this},s.unicode=function(){var a=e.encode,b=e.decode;e.encode=o,e.decode=unescape;try{this.normalize()}finally{e.encode=a,e.decode=b}return this},s.readable=function(){var b=this.clone();b.username("").password("").normalize();var c="";if(b._parts.protocol&&(c+=b._parts.protocol+"://"),b._parts.hostname&&(b.is("punycode")&&a?(c+=a.toUnicode(b._parts.hostname),b._parts.port&&(c+=":"+b._parts.port)):c+=b.host()),b._parts.hostname&&b._parts.path&&"/"!==b._parts.path.charAt(0)&&(c+="/"),c+=b.path(!0),b._parts.query){for(var d="",f=0,g=b._parts.query.split("&"),h=g.length;f<h;f++){var i=(g[f]||"").split("=");d+="&"+e.decodeQuery(i[0],this._parts.escapeQuerySpace).replace(/&/g,"%26"),void 0!==i[1]&&(d+="="+e.decodeQuery(i[1],this._parts.escapeQuerySpace).replace(/&/g,"%26"))}c+="?"+d.substring(1)}return c+=e.decodeQuery(b.hash(),!0)},s.absoluteTo=function(a){var b,c,d,f=this.clone(),g=["protocol","username","password","hostname","port"];if(this._parts.urn)throw new Error("URNs do not have any generally defined hierarchical components");if(a instanceof e||(a=new e(a)),f._parts.protocol)return f;if(f._parts.protocol=a._parts.protocol,this._parts.hostname)return f;for(c=0;d=g[c];c++)f._parts[d]=a._parts[d];return f._parts.path?(".."===f._parts.path.substring(-2)&&(f._parts.path+="/"),"/"!==f.path().charAt(0)&&(b=a.directory(),b=b?b:0===a.path().indexOf("/")?"/":"",f._parts.path=(b?b+"/":"")+f._parts.path,f.normalizePath())):(f._parts.path=a._parts.path,f._parts.query||(f._parts.query=a._parts.query)),f.build(),f},s.relativeTo=function(a){var b,c,d,f,g,h=this.clone().normalize();if(h._parts.urn)throw new Error("URNs do not have any generally defined hierarchical components");if(a=new e(a).normalize(),b=h._parts,c=a._parts,f=h.path(),g=a.path(),"/"!==f.charAt(0))throw new Error("URI is already relative");if("/"!==g.charAt(0))throw new Error("Cannot calculate a URI relative to another relative URI");if(b.protocol===c.protocol&&(b.protocol=null),b.username!==c.username||b.password!==c.password)return h.build();if(null!==b.protocol||null!==b.username||null!==b.password)return h.build();if(b.hostname!==c.hostname||b.port!==c.port)return h.build();if(b.hostname=null,b.port=null,f===g)return b.path="",h.build();if(d=e.commonPath(f,g),!d)return h.build();var i=c.path.substring(d.length).replace(/[^\/]*$/,"").replace(/.*?\//g,"../");return b.path=i+b.path.substring(d.length)||"./",h.build()},s.equals=function(a){var b,c,d,f=this.clone(),g=new e(a),h={},j={},k={};if(f.normalize(),g.normalize(),f.toString()===g.toString())return!0;if(b=f.query(),c=g.query(),f.query(""),g.query(""),f.toString()!==g.toString())return!1;if(b.length!==c.length)return!1;h=e.parseQuery(b,this._parts.escapeQuerySpace),j=e.parseQuery(c,this._parts.escapeQuerySpace);for(d in h)if(t.call(h,d)){if(i(h[d])){if(!l(h[d],j[d]))return!1}else if(h[d]!==j[d])return!1;k[d]=!0}for(d in j)if(t.call(j,d)&&!k[d])return!1;return!0},s.duplicateQueryParameters=function(a){return this._parts.duplicateQueryParameters=!!a,this},s.escapeQuerySpace=function(a){return this._parts.escapeQuerySpace=!!a,this},e}),function(a,b){"use strict";"object"==typeof module&&module.exports?module.exports=b():"function"==typeof define&&define.amd?define(b):a.IPv6=b(a)}(this,function(a){"use strict";function b(a){var b=a.toLowerCase(),c=b.split(":"),d=c.length,e=8;""===c[0]&&""===c[1]&&""===c[2]?(c.shift(),c.shift()):""===c[0]&&""===c[1]?c.shift():""===c[d-1]&&""===c[d-2]&&c.pop(),d=c.length,c[d-1].indexOf(".")!==-1&&(e=7);var f;for(f=0;f<d&&""!==c[f];f++);if(f<e)for(c.splice(f,1,"0000");c.length<e;)c.splice(f,0,"0000");for(var g,h=0;h<e;h++){g=c[h].split("");for(var i=0;i<3&&("0"===g[0]&&g.length>1);i++)g.splice(0,1);c[h]=g.join("")}var j=-1,k=0,l=0,m=-1,n=!1;for(h=0;h<e;h++)n?"0"===c[h]?l+=1:(n=!1,l>k&&(j=m,k=l)):"0"===c[h]&&(n=!0,m=h,l=1);l>k&&(j=m,k=l),k>1&&c.splice(j,k,""),d=c.length;var o="";for(""===c[0]&&(o=":"),h=0;h<d&&(o+=c[h],h!==d-1);h++)o+=":";return""===c[d-1]&&(o+=":"),o}function c(){return a.IPv6===this&&(a.IPv6=d),this}var d=a&&a.IPv6;return{best:b,noConflict:c}}),function(a){function b(a){throw new RangeError(E[a])}function c(a,b){for(var c=a.length,d=[];c--;)d[c]=b(a[c]);return d}function d(a,b){var d=a.split("@"),e="";d.length>1&&(e=d[0]+"@",a=d[1]),a=a.replace(D,".");var f=a.split("."),g=c(f,b).join(".");return e+g}function e(a){for(var b,c,d=[],e=0,f=a.length;e<f;)b=a.charCodeAt(e++),b>=55296&&b<=56319&&e<f?(c=a.charCodeAt(e++),56320==(64512&c)?d.push(((1023&b)<<10)+(1023&c)+65536):(d.push(b),e--)):d.push(b);return d}function f(a){return c(a,function(a){var b="";return a>65535&&(a-=65536,b+=H(a>>>10&1023|55296),a=56320|1023&a),b+=H(a)}).join("")}function g(a){return a-48<10?a-22:a-65<26?a-65:a-97<26?a-97:t}function h(a,b){return a+22+75*(a<26)-((0!=b)<<5)}function i(a,b,c){var d=0;for(a=c?G(a/x):a>>1,a+=G(a/b);a>F*v>>1;d+=t)a=G(a/F);return G(d+(F+1)*a/(a+w))}function j(a){var c,d,e,h,j,k,l,m,n,o,p=[],q=a.length,r=0,w=z,x=y;for(d=a.lastIndexOf(A),d<0&&(d=0),e=0;e<d;++e)a.charCodeAt(e)>=128&&b("not-basic"),p.push(a.charCodeAt(e));for(h=d>0?d+1:0;h<q;){for(j=r,k=1,l=t;h>=q&&b("invalid-input"),m=g(a.charCodeAt(h++)),(m>=t||m>G((s-r)/k))&&b("overflow"),r+=m*k,n=l<=x?u:l>=x+v?v:l-x,!(m<n);l+=t)o=t-n,k>G(s/o)&&b("overflow"),k*=o;c=p.length+1,x=i(r-j,c,0==j),G(r/c)>s-w&&b("overflow"),w+=G(r/c),r%=c,p.splice(r++,0,w)}return f(p)}function k(a){var c,d,f,g,j,k,l,m,n,o,p,q,r,w,x,B=[];for(a=e(a),q=a.length,c=z,d=0,j=y,k=0;k<q;++k)p=a[k],p<128&&B.push(H(p));for(f=g=B.length,g&&B.push(A);f<q;){for(l=s,k=0;k<q;++k)p=a[k],p>=c&&p<l&&(l=p);for(r=f+1,l-c>G((s-d)/r)&&b("overflow"),d+=(l-c)*r,c=l,k=0;k<q;++k)if(p=a[k],p<c&&++d>s&&b("overflow"),p==c){for(m=d,n=t;o=n<=j?u:n>=j+v?v:n-j,!(m<o);n+=t)x=m-o,w=t-o,B.push(H(h(o+x%w,0))),m=G(x/w);B.push(H(h(m,0))),j=i(d,r,f==g),d=0,++f}++d,++c}return B.join("")}function l(a){return d(a,function(a){return B.test(a)?j(a.slice(4).toLowerCase()):a})}function m(a){return d(a,function(a){return C.test(a)?"xn--"+k(a):a})}var n="object"==typeof exports&&exports&&!exports.nodeType&&exports,o="object"==typeof module&&module&&!module.nodeType&&module,p="object"==typeof global&&global;p.global!==p&&p.window!==p&&p.self!==p||(a=p);var q,r,s=2147483647,t=36,u=1,v=26,w=38,x=700,y=72,z=128,A="-",B=/^xn--/,C=/[^\x20-\x7E]/,D=/[\x2E\u3002\uFF0E\uFF61]/g,E={overflow:"Overflow: input needs wider integers to process","not-basic":"Illegal input >= 0x80 (not a basic code point)","invalid-input":"Invalid input"},F=t-u,G=Math.floor,H=String.fromCharCode;if(q={version:"1.3.2",ucs2:{decode:e,encode:f},decode:j,encode:k,toASCII:m,toUnicode:l},"function"==typeof define&&"object"==typeof define.amd&&define.amd)define("punycode",function(){return q});else if(n&&o)if(module.exports==n)o.exports=q;else for(r in q)q.hasOwnProperty(r)&&(n[r]=q[r]);else a.punycode=q}(this),function(a,b){function c(a){var c=b[a];b[a]=function(a){return e(c(a))}}function d(b,c,d){return(d=this).attachEvent("on"+b,function(b){var b=b||a.event;b.preventDefault=b.preventDefault||function(){b.returnValue=!1},b.stopPropagation=b.stopPropagation||function(){b.cancelBubble=!0},c.call(d,b)})}function e(a,b){if(b=a.length)for(;b--;)a[b].addEventListener=d;else a.addEventListener=d;return a}a.addEventListener||(e([b,a]),"Element"in a?a.Element.prototype.addEventListener=d:(b.attachEvent("onreadystatechange",function(){e(b.all)}),c("getElementsByTagName"),c("getElementById"),c("createElement"),e(b.all)))}(window,document),function(){var a=[].indexOf||function(a){for(var b=0,c=this.length;b<c;b++)if(b in this&&this[b]===a)return b;return-1};window.AsmodeeNet=function(){var b,c,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z,A,B,C,D,E,F,G,H,I;return G={base_is_host:"https://account.asmodee.net",base_is_path:"/main/v2/oauth",logout_endpoint:"/main/v2/logout",base_url:"https://api.asmodee.net/main/v1",client_id:null,redirect_uri:null,cancel_uri:null,logout_redirect_uri:null,callback_post_logout_redirect:null,scope:"openid+profile",response_type:"id_token token",display:"popup",display_options:{},callback_signin_success:p,callback_signin_error:o},I=A=null,c=w=b=x=s=y=n=null,h=[],z=null,u=function(){var a,b,c,d,e;if(a=window.crypto||window.msCrypto,d=0,c=[],d=a?a.getRandomValues(new Uint8Array(30)):[Math.random()],d.constructor===Array)d.forEach(function(a){return c.push(a.toString(36))});else for(b in d)e=d[b],d.hasOwnProperty(b)&&c.push(e.toString(36));return(c.join("")+"00000000000000000").slice(2,18)},r=function(a){return null==a&&(a=!1),m(),c=w=b=x=n=null,a?a():window.location.reload()},B=function(a){return"popup"===G.display?C(a):window.location.assign(a.path)},C=function(a){var b;return null==a.width&&(a.width=475),null==a.height&&(a.height=500),null==a.windowName&&(a.windowName="AsmodeeNetConnectWithOAuth"),null==a.windowOptions&&(a.windowOptions="location=0,status=0,width="+a.width+",height="+a.height),null==a.callback&&(a.callback=function(){return window.location.reload()}),b=this,b._oauthWindow=window.open(a.path,a.windowName,a.windowOptions),a.autoclose&&(b._oauthAutoCloseInterval=window.setInterval(function(){return b._oauthWindow.close(),delete b._oauthWindow,b._oauthAutoCloseInterval&&window.clearInterval(b._oauthAutoCloseInterval),b._oauthInterval&&window.clearInterval(b._oauthInterval),a.callback()},500)),b._oauthInterval=window.setInterval(function(){if(b._oauthWindow.closed)return b._oauthInterval&&window.clearInterval(b._oauthInterval),b._oauthAutoCloseInterval&&window.clearInterval(b._oauthAutoCloseInterval),a.callback()},1e3)},e=function(a){if(b=a,c=b.access_token,w=b.id_token,b.code)return n=b.code},f=function(a,b){var c;for(c=KJUR.crypto.Util.sha256(b),c=c.substr(0,c.length/2);a.length%4!==0;)a+="=";return a===btoa(c)},j=function(a,b){var c,d,e,g,i,j,k,l,m;if(b.access_token)try{d=jwt_decode(b.access_token),e=jwt_decode(b.access_token,{header:!0})}catch(a){return g=a,h.push("access_token decode error : "+g),!1}if(G.response_type.search("id_token")>=0){if(void 0===typeof b.id_token)return!1;try{i=jwt_decode(b.id_token),j=jwt_decode(b.id_token,{header:!0})}catch(a){return g=a,h.push("id_token decode error : "+g),!1}if("JWT"!==j.typ)return h.push("Invalid type"),!1;if("RS256"!==j.alg)return h.push("Invalid alg"),!1;if(a&&i.nonce!==a)return h.push("Invalid nonce"),!1;if(URL(i.iss).normalize().toString()!==URI(G.base_is_host).normalize().toString())return h.push("Invalid issuer"),!1;if(i.aud!==G.client_id&&(!Array.isArray(i.aud)||id_dec.aud.indexOf(G.client_id)===-1))return h.push("Invalid auditor"),!1;if(i.exp<(Date.now()/1e3).toPrecision(10))return h.push("Invalid expiration date"),!1;if("string"==typeof i.at_hash&&!f(i.at_hash,b.access_token))return h.push("Invalid at_hash"),!1;if(b.code&&"string"==typeof i.c_hash&&!f(i.c_hash,b.code))return h.push("Invalid c_hash"),!1;for(c=[j.alg],k=0,m=y.length;k<m;k++)if(l=y[k],KJUR.jws.JWS.verify(b.id_token,KEYUTIL.getKey(l),c))return!0;return h.push("Invalid JWS key"),!1}return!0},k=function(){var a;if(G.base_is_host&&(a=URI(G.base_is_host),G.base_is_host=a.protocol()+"://"+a.host()),G.base_url&&(G.base_url=URI(G.base_url).normalize().toString()),G.logout_redirect_uri)return G.logout_redirect_uri=URI(G.logout_redirect_uri).normalize().toString()},i=function(){var a,b;if(G.logout_redirect_uri&&(b=new RegExp(G.logout_redirect_uri.replace(/([?.+*()])/g,"\\$1")),b.test(window.location.href)&&(a=window.location.href.replace(G.logout_redirect_uri+"&state=","").replace(/[&#].*$/,""),a===v("logout_state")||!a&&!v("logout_state"))))return D("logout_state"),G.callback_post_logout_redirect?G.callback_post_logout_redirect():window.location="/"},p=function(){return console.log(arguments)},o=function(){return console.error(arguments)},H=function(a){var b,c,d,f,g,i,k,l;if(c=v("gd_connect_hash")){if(D("gd_connect_hash"),b={},k=null,0===c.search(/^#/)){for(k=c.replace(/^#/,"").split("&"),d=0,g=k.length;d<g;d++)l=k[d],l=l.split("="),b[l[0]]=l[1];if(b.token_type&&"bearer"===b.token_type&&(I=v("state"),A=v("nonce"),b.state&&b.state===I))return b.scope=b.scope.split("+"),h=[],j(A,b)?(D("state"),D("nonce"),e(b),a.identity({success:G.callback_signin_success,error:G.callback_signin_error})):G.callback_signin_error("Tokens validation issue : ",h)}else if(0===c.search(/^\?/)){for(k=c.replace(/^\?/,"").split("&"),f=0,i=k.length;f<i;f++)l=k[f],l=l.split("="),b[l[0]]=l[1];if(b.state&&b.state===I)return G.callback_signin_error(b.error+" : "+b.error_description.replace(/\+/g," "))}}else if("popup"===G.display)return G.callback_signin_error("popup closed without signin")},g=function(){var b,c,d,e,f;if(Object.keys(G.display_options).length>0)if("touch"===(c=G.display)||"popup"===c){e={noheader:!1,nofooter:!1,lnk2bt:!1,leglnk:!0},d=G.display_options;for(b in d)f=d[b],a.call(Object.keys(e),b)<0&&delete G.display_options[b];Object.keys(G.display_options).length>0&&(G.display_options=AsmodeeNet.extend(e,G.display_options))}else G.display_options={};if("touch"===G.display&&(0===Object.keys(G.display_options).length&&(G.display_options={noheader:!0,nofooter:!0,lnk2bt:!0,leglnk:!1}),!G.cancel_uri))return G.cancel_uri=G.redirect_uri},E=function(a,b,c){var d,e;return c?(d=new Date,d.setTime(d.getTime()+1e3*c),e="; expires="+d.toGMTString()):e="",document.cookie=a+"="+b+e+"; path=/"},t=function(a){var b,c,d,e;for(e=a+"=",c=document.cookie.split(";"),d=0;d<c.length;){for(b=c[d];" "===b.charAt(0);)b=b.substring(1,b.length);if(0===b.indexOf(e))return b.substring(e.length,b.length);d++}return null},q=function(a){return E(a,"",-1)},l=function(){var a,b,c,e,f,g,h;for(c=document.cookie.split("; "),h=[],e=0,f=c.length;e<f;e++)a=c[e],b=encodeURIComponent(a.split(";")[0].split("=")[0])+"=; expires=Thu, 01-Jan-1970 00:00:01 GMT; domain="+d.join(".")+" ;path=",g=location.pathname.split("/"),h.push(function(){var a;for(a=[];g.length>0;)document.cookie=b+g.join("/"),a.push(g.pop());return a}());return h},F=function(a,b,c){var d;try{return store.set(a,b,(new Date).getTime()+c)}catch(c){return d=c,console.error("SetItem '"+a+"'",b,d)}},v=function(a){var b;try{return store.get(a)}catch(c){return b=c,console.error("GetItem '"+a+"'",b),null}},D=function(a){return store.remove(a)},m=function(){return store.clearAll()},{init:function(a){return G=this.extend(G,a),k(),g(),i(),this},baseSettings:function(){return{crossDomain:!0,dataType:"json",headers:{Authorization:"Bearer "+c,Accept:"application/json"}}},isConnected:function(){return null!==this.getAccessToken()},getAccessToken:function(){return c},getIdToken:function(){return w},getAccessHash:function(){return b},getDiscovery:function(){return s},getCode:function(){return n},getCheckErrors:function(){return h},isJwksDone:function(){return null!==y},getConfiguredScope:function(){return G.scope},getConfiguredAPI:function(){return G.base_url},getClientId:function(){return G.client_id},auth_endpoint:function(){return s?URI(s.authorization_endpoint).normalize().toString():URI(G.base_is_host+G.base_is_path+"/authorize").normalize().toString()},ident_endpoint:function(){return s?URI(s.userinfo_endpoint).normalize().toString():URI(G.base_is_host+G.base_is_path+"/identity").normalize().toString()},ajaxq:function(a,b,c){var d,e;return null==c&&(c={}),d=c.base_url||G.base_url,delete c.base_url,e=this.extend(c,this.baseSettings(),{type:a}),void 0!==c.auth&&c.auth===!1&&(e.headers.Authorization&&delete e.headers.Authorization,delete e.auth),this.ajax(d+b,e)},get:function(a,b){return this.ajaxq("GET",a,b)},post:function(a,b){return this.ajaxq("POST",a,b)},update:function(a,b){return this.ajaxq("PUT",a,b)},delete:function(a,b){return this.ajaxq("DELETE",a,b)},discover:function(a){var b;return a=a||G.base_is_host,b=this,this.get("/.well-known/openid-configuration",{base_url:URI(a).normalize().toString(),auth:!1,success:function(a){return s="object"==typeof a?a:JSON.parse(a),G.base_is_host=URI(s.issuer).normalize().toString(),G.logout_endpoint=URI(s.end_session_endpoint).normalize().toString(),b.getJwks()},error:function(){return console.error("error Discovery ",arguments)}})},getJwks:function(){var a;return a=this,this.get("",{base_url:URI(s.jwks_uri).normalize().toString(),auth:!1,success:function(b){if(y="object"==typeof b?b.keys:JSON.parse(b).keys,"popup"!==G.display)return H(a)},error:function(){if(console.error("error JWKS",arguments),arguments.length>0&&console.error("error JWKS => "+arguments[0]),arguments.length>0)return console.error("error JWKS => "+arguments[0].statusText)}})},signIn:function(a){var b,c,d,f;if(I=u(),A=u(),F("state",I,100),F("nonce",A,100),G.callback_signin_success=a.success||G.callback_signin_success,G.callback_signin_error=a.error||G.callback_signin_error,a.path=this.auth_endpoint()+"?display="+G.display+"&response_type="+encodeURI(G.response_type)+"&state="+I+"&client_id="+G.client_id+"&scope="+G.scope,G.redirect_uri&&(a.path+="&redirect_uri="+encodeURI(G.redirect_uri)),G.response_type.search("id_token")>=0&&(a.path+="&nonce="+A),Object.keys(G.display_options).length>0){d=G.display_options;for(c in d)f=d[c],a.path+="&display_opts["+c+"]="+(f?"1":"0")}return G.cancel_uri&&(a.path+="&cancel_uri="+encodeURI(G.cancel_uri)),b=this,a.callback=function(){var a,c,d,f,g,i,k,l;if(c=v("gd_connect_hash")){if(D("gd_connect_hash"),a={},k=null,0===c.search(/^#/)){for(k=c.replace(/^#/,"").split("&"),d=0,g=k.length;d<g;d++)l=k[d],l=l.split("="),a[l[0]]=l[1];if(a.token_type&&"bearer"===a.token_type&&(I=v("state"),A=v("nonce"),a.state&&a.state===I))return a.scope=a.scope.split("+"),h=[],j(A,a)?(D("state"),D("nonce"),e(a),b.identity({success:G.callback_signin_success,error:G.callback_signin_error})):G.callback_signin_error("Tokens validation issue",h)}else if(0===c.search(/^\?/)){for(k=c.replace(/^\?/,"").split("&"),f=0,i=k.length;f<i;f++)l=k[f],l=l.split("="),a[l[0]]=l[1];if(a.state&&a.state===I)return G.callback_signin_error(a.error+" : "+a.error_description.replace(/\+/g," "))}}else if("popup"===G.display)return G.callback_signin_error("popup closed without signin")},B(a)},identity:function(a){return this.isConnected()?this.isConnected()&&x?a&&a.success?a.success(x,AsmodeeNet.getCode()):void 0:this.get("",{base_url:this.ident_endpoint(),success:function(b){if(x=b,a&&a.success)return a.success(x,AsmodeeNet.getCode())},error:function(b,c,d,e){return a&&a.error?a.error(b,c,d,e):console.error("identity error",b,c,d,e)}}):(a&&a.error?a.error("Identity error. Not connected",null,null,"Not Connected"):console.error("identity error","You're not connected"),!1)},restoreTokens:function(a,b,d,f){var g;if(null==d&&(d=!0),null==f&&(f=null),a&&c&&(a=null),b&&w&&(w=null),a)if(g={access_token:a,id_token:b},this.isJwksDone())if(j(null,g)){if(e(g),d&&this.identity({success:G.callback_signin_success,error:G.callback_signin_error}),!f)return!0;f(!0)}else{if(!f)return!1;f(!1,h)}else setTimeout(function(){return AsmodeeNet.restoreTokens(a,b,d,f)},200);return null},setAccessToken:function(a){return c=a},setIdToken:function(a){return w=a},signOut:function(a){if(this.isConnected())return G.logout_redirect_uri?(I=u(),F("logout_state",I,100),window.location=G.logout_endpoint+"?post_logout_redirect_uri="+encodeURI(G.logout_redirect_uri)+"&state="+I+"&id_token_hint="+w):r(a.success)},trackCb:function(a){if(null==a&&(a=!0),""!==window.location.hash?F("gd_connect_hash",window.location.hash,100):""!==window.location.search&&F("gd_connect_hash",window.location.search,100),"AsmodeeNetConnectWithOAuth"===window.name&&a)return window.close()}}}(),"undefined"==typeof window.AN&&(window.AN=window.AsmodeeNet),"undefined"==typeof window.GamifyDigital&&(window.GamifyDigital=window.AsmodeeNet),"undefined"==typeof window.GD&&(window.GD=window.AsmodeeNet)}.call(this),function(){window.AsmodeeNet.extend=function(){var a,b,c,d,e;for(e={},a=0,c=arguments.length;a<c;a++){d=arguments[a];for(b in d)Object.prototype.hasOwnProperty.call(d,b)&&(e[b]=d[b])}return e},window.AsmodeeNet.jwt_decode=function(a,b){var c;return c=KJUR.jws.JWS.parse(a),b&&"undefined"!==b.header&&b.header===!0?c.headerObj:c.payloadObj},window.jwt_decode||(window.jwt_decode=window.AsmodeeNet.jwt_decode)}.call(this),function(){window.AsmodeeNet.ajax=function(a,b){var c,d,e,f,g,h,i,j,k,l,m;c=arguments,b=1===c.length?c[0]:c[1],f=function(){return null},e={url:2===c.length&&"string"==typeof a?a:".",cache:!0,data:{},headers:{},context:null,type:"GET",success:f,error:f,complete:f},b=this.extend(e,b||{}),i={"application/json":"json","text/html":"html","text/plain":"text"},b.cache||(b.url=b.url+(null!=(k=b.url.indexOf("?"))?k:{"&":"?"})+"noCache="+Math.floor(9e9*Math.random())),l=function(a,b,c){var e;return e="success",c.success.call(c.context,a,e,b),d(e,b,c)},g=function(a,b,c,e){return e.error.call(e.context,c,b,a),d(b,c,e)},d=function(a,b,c){return c.complete.call(c.context,b,a)},m=new XMLHttpRequest,j=function(){var a,c,d,e;if(4===m.readyState){if(e=null,a=null,m.status>=200&&m.status<300||304===m.status){d=m.getResponseHeader("content-type"),a=i[d]||"text",e=m.responseText;try{return"json"===a&&(e=JSON.parse(e)),void l(e,m,b)}catch(a){c=a}}return g(null,"error",m,b)}},m.addEventListener?m.addEventListener("readystatechange",j,!1):m.attachEvent&&m.attachEvent("onreadystatechange",j),m.open(b.type,b.url),"POST"===b.type&&(b.headers=this.extend(b.headers,{"X-Requested-With":"XMLHttpRequest","Content-type":"application/x-www-form-urlencoded"}));for(h in b.headers)m.setRequestHeader(h,b.headers[h]);return m.send(b.data),this}}.call(this),"undefined"!=typeof KJUR&&KJUR||(KJUR={}),"undefined"!=typeof KJUR.jws&&KJUR.jws||(KJUR.jws={}),KJUR.jws.JWS=function(){var a=KJUR.jws.JWS;this.parseJWS=function(b,c){if(void 0===this.parsedJWS||!c&&void 0===this.parsedJWS.sigvalH){if(null==b.match(/^([^.]+)\.([^.]+)\.([^.]+)$/))throw"JWS signature is not a form of 'Head.Payload.SigValue'.";var d=RegExp.$1,e=RegExp.$2,f=RegExp.$3,g=d+"."+e;if(this.parsedJWS={},this.parsedJWS.headB64U=d,this.parsedJWS.payloadB64U=e,this.parsedJWS.sigvalB64U=f,this.parsedJWS.si=g,!c){var h=b64utohex(f),i=parseBigInt(h,16);this.parsedJWS.sigvalH=h,this.parsedJWS.sigvalBI=i}var j=b64utoutf8(d),k=b64utoutf8(e);if(this.parsedJWS.headS=j,this.parsedJWS.payloadS=k,!a.isSafeJSONString(j,this.parsedJWS,"headP"))throw"malformed JSON string for JWS Head: "+j}}},KJUR.jws.JWS.sign=function(a,b,c,d,e){var f,g,h,i=KJUR.jws.JWS;if("string"!=typeof b&&"object"!=typeof b)throw"spHeader must be JSON string or object: "+b;if("object"==typeof b&&(g=b,f=JSON.stringify(g)),"string"==typeof b){if(f=b,!i.isSafeJSONString(f))throw"JWS Head is not safe JSON string: "+f;g=i.readSafeJSONString(f)}if(h=c,"object"==typeof c&&(h=JSON.stringify(c)),""!=a&&null!=a||void 0===g.alg||(a=g.alg),""!=a&&null!=a&&void 0===g.alg&&(g.alg=a,f=JSON.stringify(g)),a!==g.alg)throw"alg and sHeader.alg doesn't match: "+a+"!="+g.alg;var j=null;if(void 0===i.jwsalg2sigalg[a])throw"unsupported alg name: "+a;j=i.jwsalg2sigalg[a];var k=utf8tob64u(f),l=utf8tob64u(h),m=k+"."+l,n="";if("Hmac"==j.substr(0,4)){if(void 0===d)throw"mac key shall be specified for HS* alg";var o=new KJUR.crypto.Mac({alg:j,prov:"cryptojs",pass:d});o.updateString(m),n=o.doFinal()}else if(j.indexOf("withECDSA")!=-1){var p=new KJUR.crypto.Signature({alg:j});p.init(d,e),p.updateString(m),hASN1Sig=p.sign(),n=KJUR.crypto.ECDSA.asn1SigToConcatSig(hASN1Sig)}else if("none"!=j){var p=new KJUR.crypto.Signature({alg:j});p.init(d,e),p.updateString(m),n=p.sign()}var q=hextob64u(n);return m+"."+q},KJUR.jws.JWS.verify=function(a,b,c){var d=KJUR.jws.JWS,e=a.split("."),f=e[0],g=e[1],h=f+"."+g,i=b64utohex(e[2]),j=d.readSafeJSONString(b64utoutf8(e[0])),k=null,l=null;if(void 0===j.alg)throw"algorithm not specified in header";if(k=j.alg,l=k.substr(0,2),null!=c&&"[object Array]"===Object.prototype.toString.call(c)&&c.length>0){var m=":"+c.join(":")+":";if(m.indexOf(":"+k+":")==-1)throw"algorithm '"+k+"' not accepted in the list"}if("none"!=k&&null===b)throw"key shall be specified to verify.";if("string"==typeof b&&b.indexOf("-----BEGIN ")!=-1&&(b=KEYUTIL.getKey(b)),!("RS"!=l&&"PS"!=l||b instanceof RSAKey))throw"key shall be a RSAKey obj for RS* and PS* algs";if("ES"==l&&!(b instanceof KJUR.crypto.ECDSA))throw"key shall be a ECDSA obj for ES* algs";var n=null;if(void 0===d.jwsalg2sigalg[j.alg])throw"unsupported alg name: "+k;if(n=d.jwsalg2sigalg[k],"none"==n)throw"not supported";if("Hmac"==n.substr(0,4)){var o=null;if(void 0===b)throw"hexadecimal key shall be specified for HMAC";var p=new KJUR.crypto.Mac({alg:n,pass:b});return p.updateString(h),o=p.doFinal(),i==o}if(n.indexOf("withECDSA")!=-1){var q=null;try{q=KJUR.crypto.ECDSA.concatSigToASN1Sig(i)}catch(a){return!1}var r=new KJUR.crypto.Signature({alg:n});return r.init(b),r.updateString(h),r.verify(q)}var r=new KJUR.crypto.Signature({alg:n});return r.init(b),r.updateString(h),r.verify(i)},KJUR.jws.JWS.parse=function(a){var b,c,d,e=a.split("."),f={};if(2!=e.length&&3!=e.length)throw"malformed sJWS: wrong number of '.' splitted elements";return b=e[0],c=e[1],3==e.length&&(d=e[2]),f.headerObj=KJUR.jws.JWS.readSafeJSONString(b64utoutf8(b)),f.payloadObj=KJUR.jws.JWS.readSafeJSONString(b64utoutf8(c)),f.headerPP=JSON.stringify(f.headerObj,null,"  "),null==f.payloadObj?f.payloadPP=b64utoutf8(c):f.payloadPP=JSON.stringify(f.payloadObj,null,"  "),void 0!==d&&(f.sigHex=b64utohex(d)),f},KJUR.jws.JWS.verifyJWT=function(a,b,c){var d=KJUR.jws.JWS,e=a.split("."),f=e[0],g=e[1],h=(b64utohex(e[2]),d.readSafeJSONString(b64utoutf8(f))),i=d.readSafeJSONString(b64utoutf8(g));if(void 0===h.alg)return!1;if(void 0===c.alg)throw"acceptField.alg shall be specified";if(!d.inArray(h.alg,c.alg))return!1;if(void 0!==i.iss&&"object"==typeof c.iss&&!d.inArray(i.iss,c.iss))return!1;if(void 0!==i.sub&&"object"==typeof c.sub&&!d.inArray(i.sub,c.sub))return!1;if(void 0!==i.aud&&"object"==typeof c.aud)if("string"==typeof i.aud){if(!d.inArray(i.aud,c.aud))return!1}else if("object"==typeof i.aud&&!d.includedArray(i.aud,c.aud))return!1;var j=KJUR.jws.IntDate.getNow();return void 0!==c.verifyAt&&"number"==typeof c.verifyAt&&(j=c.verifyAt),void 0!==c.gracePeriod&&"number"==typeof c.gracePeriod||(c.gracePeriod=0),!(void 0!==i.exp&&"number"==typeof i.exp&&i.exp+c.gracePeriod<j)&&(!(void 0!==i.nbf&&"number"==typeof i.nbf&&j<i.nbf-c.gracePeriod)&&(!(void 0!==i.iat&&"number"==typeof i.iat&&j<i.iat-c.gracePeriod)&&((void 0===i.jti||void 0===c.jti||i.jti===c.jti)&&!!KJUR.jws.JWS.verify(a,b,c.alg))))},KJUR.jws.JWS.includedArray=function(a,b){var c=KJUR.jws.JWS.inArray;if(null===a)return!1;if("object"!=typeof a)return!1;if("number"!=typeof a.length)return!1;for(var d=0;d<a.length;d++)if(!c(a[d],b))return!1;return!0},KJUR.jws.JWS.inArray=function(a,b){if(null===b)return!1;if("object"!=typeof b)return!1;if("number"!=typeof b.length)return!1;for(var c=0;c<b.length;c++)if(b[c]==a)return!0;return!1},KJUR.jws.JWS.jwsalg2sigalg={HS256:"HmacSHA256",HS384:"HmacSHA384",HS512:"HmacSHA512",RS256:"SHA256withRSA",RS384:"SHA384withRSA",RS512:"SHA512withRSA",ES256:"SHA256withECDSA",ES384:"SHA384withECDSA",PS256:"SHA256withRSAandMGF1",PS384:"SHA384withRSAandMGF1",PS512:"SHA512withRSAandMGF1",none:"none"},KJUR.jws.JWS.isSafeJSONString=function(a,b,c){var d=null;try{return d=jsonParse(a),"object"!=typeof d?0:d.constructor===Array?0:(b&&(b[c]=d),1)}catch(a){return 0}},KJUR.jws.JWS.readSafeJSONString=function(a){var b=null;try{return b=jsonParse(a),"object"!=typeof b?null:b.constructor===Array?null:b}catch(a){return null}},KJUR.jws.JWS.getEncodedSignatureValueFromJWS=function(a){if(null==a.match(/^[^.]+\.[^.]+\.([^.]+)$/))throw"JWS signature is not a form of 'Head.Payload.SigValue'.";return RegExp.$1},KJUR.jws.JWS.getJWKthumbprint=function(a){if("RSA"!==a.kty&&"EC"!==a.kty&&"oct"!==a.kty)throw"unsupported algorithm for JWK Thumprint";var b="{";if("RSA"===a.kty){if("string"!=typeof a.n||"string"!=typeof a.e)throw"wrong n and e value for RSA key";b+='"e":"'+a.e+'",',b+='"kty":"'+a.kty+'",',b+='"n":"'+a.n+'"}'}else if("EC"===a.kty){if("string"!=typeof a.crv||"string"!=typeof a.x||"string"!=typeof a.y)throw"wrong crv, x and y value for EC key";b+='"crv":"'+a.crv+'",',b+='"kty":"'+a.kty+'",',b+='"x":"'+a.x+'",',b+='"y":"'+a.y+'"}'}else if("oct"===a.kty){if("string"!=typeof a.k)throw"wrong k value for oct(symmetric) key";b+='"kty":"'+a.kty+'",',b+='"k":"'+a.k+'"}'}var c=rstrtohex(b),d=KJUR.crypto.Util.hashHex(c,"sha256"),e=hextob64u(d);return e},KJUR.jws.IntDate={},
KJUR.jws.IntDate.get=function(a){if("now"==a)return KJUR.jws.IntDate.getNow();if("now + 1hour"==a)return KJUR.jws.IntDate.getNow()+3600;if("now + 1day"==a)return KJUR.jws.IntDate.getNow()+86400;if("now + 1month"==a)return KJUR.jws.IntDate.getNow()+2592e3;if("now + 1year"==a)return KJUR.jws.IntDate.getNow()+31536e3;if(a.match(/Z$/))return KJUR.jws.IntDate.getZulu(a);if(a.match(/^[0-9]+$/))return parseInt(a);throw"unsupported format: "+a},KJUR.jws.IntDate.getZulu=function(a){var b;if(b=a.match(/(\d+)(\d\d)(\d\d)(\d\d)(\d\d)(\d\d)Z/)){var c=RegExp.$1,d=parseInt(c);if(4==c.length);else{if(2!=c.length)throw"malformed year string";if(50<=d&&d<100)d=1900+d;else{if(!(0<=d&&d<50))throw"malformed year string for UTCTime";d=2e3+d}}var e=parseInt(RegExp.$2)-1,f=parseInt(RegExp.$3),g=parseInt(RegExp.$4),h=parseInt(RegExp.$5),i=parseInt(RegExp.$6),j=new Date(Date.UTC(d,e,f,g,h,i));return~~(j/1e3)}throw"unsupported format: "+a},KJUR.jws.IntDate.getNow=function(){var a=~~(new Date/1e3);return a},KJUR.jws.IntDate.intDate2UTCString=function(a){var b=new Date(1e3*a);return b.toUTCString()},KJUR.jws.IntDate.intDate2Zulu=function(a){var b=new Date(1e3*a),c=("0000"+b.getUTCFullYear()).slice(-4),d=("00"+(b.getUTCMonth()+1)).slice(-2),e=("00"+b.getUTCDate()).slice(-2),f=("00"+b.getUTCHours()).slice(-2),g=("00"+b.getUTCMinutes()).slice(-2),h=("00"+b.getUTCSeconds()).slice(-2);return c+d+e+f+g+h+"Z"},"undefined"!=typeof KJUR&&KJUR||(KJUR={}),"undefined"!=typeof KJUR.crypto&&KJUR.crypto||(KJUR.crypto={}),KJUR.crypto.Util=new function(){this.DIGESTINFOHEAD={sha1:"3021300906052b0e03021a05000414",sha224:"302d300d06096086480165030402040500041c",sha256:"3031300d060960864801650304020105000420",sha384:"3041300d060960864801650304020205000430",sha512:"3051300d060960864801650304020305000440",md2:"3020300c06082a864886f70d020205000410",md5:"3020300c06082a864886f70d020505000410",ripemd160:"3021300906052b2403020105000414"},this.DEFAULTPROVIDER={md5:"cryptojs",sha1:"cryptojs",sha224:"cryptojs",sha256:"cryptojs",sha384:"cryptojs",sha512:"cryptojs",ripemd160:"cryptojs",hmacmd5:"cryptojs",hmacsha1:"cryptojs",hmacsha224:"cryptojs",hmacsha256:"cryptojs",hmacsha384:"cryptojs",hmacsha512:"cryptojs",hmacripemd160:"cryptojs",MD5withRSA:"cryptojs/jsrsa",SHA1withRSA:"cryptojs/jsrsa",SHA224withRSA:"cryptojs/jsrsa",SHA256withRSA:"cryptojs/jsrsa",SHA384withRSA:"cryptojs/jsrsa",SHA512withRSA:"cryptojs/jsrsa",RIPEMD160withRSA:"cryptojs/jsrsa",MD5withECDSA:"cryptojs/jsrsa",SHA1withECDSA:"cryptojs/jsrsa",SHA224withECDSA:"cryptojs/jsrsa",SHA256withECDSA:"cryptojs/jsrsa",SHA384withECDSA:"cryptojs/jsrsa",SHA512withECDSA:"cryptojs/jsrsa",RIPEMD160withECDSA:"cryptojs/jsrsa",SHA1withDSA:"cryptojs/jsrsa",SHA224withDSA:"cryptojs/jsrsa",SHA256withDSA:"cryptojs/jsrsa",MD5withRSAandMGF1:"cryptojs/jsrsa",SHA1withRSAandMGF1:"cryptojs/jsrsa",SHA224withRSAandMGF1:"cryptojs/jsrsa",SHA256withRSAandMGF1:"cryptojs/jsrsa",SHA384withRSAandMGF1:"cryptojs/jsrsa",SHA512withRSAandMGF1:"cryptojs/jsrsa",RIPEMD160withRSAandMGF1:"cryptojs/jsrsa"},this.CRYPTOJSMESSAGEDIGESTNAME={md5:CryptoJS.algo.MD5,sha1:CryptoJS.algo.SHA1,sha224:CryptoJS.algo.SHA224,sha256:CryptoJS.algo.SHA256,sha384:CryptoJS.algo.SHA384,sha512:CryptoJS.algo.SHA512,ripemd160:CryptoJS.algo.RIPEMD160},this.getDigestInfoHex=function(a,b){if("undefined"==typeof this.DIGESTINFOHEAD[b])throw"alg not supported in Util.DIGESTINFOHEAD: "+b;return this.DIGESTINFOHEAD[b]+a},this.getPaddedDigestInfoHex=function(a,b,c){var d=this.getDigestInfoHex(a,b),e=c/4;if(d.length+22>e)throw"key is too short for SigAlg: keylen="+c+","+b;for(var f="0001",g="00"+d,h="",i=e-f.length-g.length,j=0;j<i;j+=2)h+="ff";var k=f+h+g;return k},this.hashString=function(a,b){var c=new KJUR.crypto.MessageDigest({alg:b});return c.digestString(a)},this.hashHex=function(a,b){var c=new KJUR.crypto.MessageDigest({alg:b});return c.digestHex(a)},this.sha1=function(a){var b=new KJUR.crypto.MessageDigest({alg:"sha1",prov:"cryptojs"});return b.digestString(a)},this.sha256=function(a){var b=new KJUR.crypto.MessageDigest({alg:"sha256",prov:"cryptojs"});return b.digestString(a)},this.sha256Hex=function(a){var b=new KJUR.crypto.MessageDigest({alg:"sha256",prov:"cryptojs"});return b.digestHex(a)},this.sha512=function(a){var b=new KJUR.crypto.MessageDigest({alg:"sha512",prov:"cryptojs"});return b.digestString(a)},this.sha512Hex=function(a){var b=new KJUR.crypto.MessageDigest({alg:"sha512",prov:"cryptojs"});return b.digestHex(a)},this.md5=function(a){var b=new KJUR.crypto.MessageDigest({alg:"md5",prov:"cryptojs"});return b.digestString(a)},this.ripemd160=function(a){var b=new KJUR.crypto.MessageDigest({alg:"ripemd160",prov:"cryptojs"});return b.digestString(a)},this.getCryptoJSMDByName=function(a){}},KJUR.crypto.MessageDigest=function(a){this.setAlgAndProvider=function(a,b){if(null!=a&&void 0===b&&(b=KJUR.crypto.Util.DEFAULTPROVIDER[a]),":md5:sha1:sha224:sha256:sha384:sha512:ripemd160:".indexOf(a)!=-1&&"cryptojs"==b){try{this.md=KJUR.crypto.Util.CRYPTOJSMESSAGEDIGESTNAME[a].create()}catch(b){throw"setAlgAndProvider hash alg set fail alg="+a+"/"+b}this.updateString=function(a){this.md.update(a)},this.updateHex=function(a){var b=CryptoJS.enc.Hex.parse(a);this.md.update(b)},this.digest=function(){var a=this.md.finalize();return a.toString(CryptoJS.enc.Hex)},this.digestString=function(a){return this.updateString(a),this.digest()},this.digestHex=function(a){return this.updateHex(a),this.digest()}}if(":sha256:".indexOf(a)!=-1&&"sjcl"==b){try{this.md=new sjcl.hash.sha256}catch(b){throw"setAlgAndProvider hash alg set fail alg="+a+"/"+b}this.updateString=function(a){this.md.update(a)},this.updateHex=function(a){var b=sjcl.codec.hex.toBits(a);this.md.update(b)},this.digest=function(){var a=this.md.finalize();return sjcl.codec.hex.fromBits(a)},this.digestString=function(a){return this.updateString(a),this.digest()},this.digestHex=function(a){return this.updateHex(a),this.digest()}}},this.updateString=function(a){throw"updateString(str) not supported for this alg/prov: "+this.algName+"/"+this.provName},this.updateHex=function(a){throw"updateHex(hex) not supported for this alg/prov: "+this.algName+"/"+this.provName},this.digest=function(){throw"digest() not supported for this alg/prov: "+this.algName+"/"+this.provName},this.digestString=function(a){throw"digestString(str) not supported for this alg/prov: "+this.algName+"/"+this.provName},this.digestHex=function(a){throw"digestHex(hex) not supported for this alg/prov: "+this.algName+"/"+this.provName},void 0!==a&&void 0!==a.alg&&(this.algName=a.alg,void 0===a.prov&&(this.provName=KJUR.crypto.Util.DEFAULTPROVIDER[this.algName]),this.setAlgAndProvider(this.algName,this.provName))},KJUR.crypto.Mac=function(a){this.setAlgAndProvider=function(a,b){if(a=a.toLowerCase(),null==a&&(a="hmacsha1"),a=a.toLowerCase(),"hmac"!=a.substr(0,4))throw"setAlgAndProvider unsupported HMAC alg: "+a;void 0===b&&(b=KJUR.crypto.Util.DEFAULTPROVIDER[a]),this.algProv=a+"/"+b;var c=a.substr(4);if(":md5:sha1:sha224:sha256:sha384:sha512:ripemd160:".indexOf(c)!=-1&&"cryptojs"==b){try{var d=KJUR.crypto.Util.CRYPTOJSMESSAGEDIGESTNAME[c];this.mac=CryptoJS.algo.HMAC.create(d,this.pass)}catch(a){throw"setAlgAndProvider hash alg set fail hashAlg="+c+"/"+a}this.updateString=function(a){this.mac.update(a)},this.updateHex=function(a){var b=CryptoJS.enc.Hex.parse(a);this.mac.update(b)},this.doFinal=function(){var a=this.mac.finalize();return a.toString(CryptoJS.enc.Hex)},this.doFinalString=function(a){return this.updateString(a),this.doFinal()},this.doFinalHex=function(a){return this.updateHex(a),this.doFinal()}}},this.updateString=function(a){throw"updateString(str) not supported for this alg/prov: "+this.algProv},this.updateHex=function(a){throw"updateHex(hex) not supported for this alg/prov: "+this.algProv},this.doFinal=function(){throw"digest() not supported for this alg/prov: "+this.algProv},this.doFinalString=function(a){throw"digestString(str) not supported for this alg/prov: "+this.algProv},this.doFinalHex=function(a){throw"digestHex(hex) not supported for this alg/prov: "+this.algProv},this.setPassword=function(a){if("string"==typeof a){var b=a;return a.length%2!=1&&a.match(/^[0-9A-Fa-f]+$/)||(b=rstrtohex(a)),void(this.pass=CryptoJS.enc.Hex.parse(b))}if("object"!=typeof a)throw"KJUR.crypto.Mac unsupported password type: "+a;var b=null;if(void 0!==a.hex){if(a.hex.length%2!=0||!a.hex.match(/^[0-9A-Fa-f]+$/))throw"Mac: wrong hex password: "+a.hex;b=a.hex}if(void 0!==a.utf8&&(b=utf8tohex(a.utf8)),void 0!==a.rstr&&(b=rstrtohex(a.rstr)),void 0!==a.b64&&(b=b64tohex(a.b64)),void 0!==a.b64u&&(b=b64utohex(a.b64u)),null==b)throw"KJUR.crypto.Mac unsupported password type: "+a;this.pass=CryptoJS.enc.Hex.parse(b)},void 0!==a&&(void 0!==a.pass&&this.setPassword(a.pass),void 0!==a.alg&&(this.algName=a.alg,void 0===a.prov&&(this.provName=KJUR.crypto.Util.DEFAULTPROVIDER[this.algName]),this.setAlgAndProvider(this.algName,this.provName)))},KJUR.crypto.Signature=function(a){var b=null;if(this._setAlgNames=function(){this.algName.match(/^(.+)with(.+)$/)&&(this.mdAlgName=RegExp.$1.toLowerCase(),this.pubkeyAlgName=RegExp.$2.toLowerCase())},this._zeroPaddingOfSignature=function(a,b){for(var c="",d=b/4-a.length,e=0;e<d;e++)c+="0";return c+a},this.setAlgAndProvider=function(a,b){if(this._setAlgNames(),"cryptojs/jsrsa"!=b)throw"provider not supported: "+b;if(":md5:sha1:sha224:sha256:sha384:sha512:ripemd160:".indexOf(this.mdAlgName)!=-1){try{this.md=new KJUR.crypto.MessageDigest({alg:this.mdAlgName})}catch(a){throw"setAlgAndProvider hash alg set fail alg="+this.mdAlgName+"/"+a}this.init=function(a,b){var c=null;try{c=void 0===b?KEYUTIL.getKey(a):KEYUTIL.getKey(a,b)}catch(a){throw"init failed:"+a}if(c.isPrivate===!0)this.prvKey=c,this.state="SIGN";else{if(c.isPublic!==!0)throw"init failed.:"+c;this.pubKey=c,this.state="VERIFY"}},this.initSign=function(a){"string"==typeof a.ecprvhex&&"string"==typeof a.eccurvename?(this.ecprvhex=a.ecprvhex,this.eccurvename=a.eccurvename):this.prvKey=a,this.state="SIGN"},this.initVerifyByPublicKey=function(a){"string"==typeof a.ecpubhex&&"string"==typeof a.eccurvename?(this.ecpubhex=a.ecpubhex,this.eccurvename=a.eccurvename):a instanceof KJUR.crypto.ECDSA?this.pubKey=a:a instanceof RSAKey&&(this.pubKey=a),this.state="VERIFY"},this.initVerifyByCertificatePEM=function(a){var b=new X509;b.readCertPEM(a),this.pubKey=b.subjectPublicKeyRSA,this.state="VERIFY"},this.updateString=function(a){this.md.updateString(a)},this.updateHex=function(a){this.md.updateHex(a)},this.sign=function(){if(this.sHashHex=this.md.digest(),"undefined"!=typeof this.ecprvhex&&"undefined"!=typeof this.eccurvename){var a=new KJUR.crypto.ECDSA({curve:this.eccurvename});this.hSign=a.signHex(this.sHashHex,this.ecprvhex)}else if(this.prvKey instanceof RSAKey&&"rsaandmgf1"==this.pubkeyAlgName)this.hSign=this.prvKey.signWithMessageHashPSS(this.sHashHex,this.mdAlgName,this.pssSaltLen);else if(this.prvKey instanceof RSAKey&&"rsa"==this.pubkeyAlgName)this.hSign=this.prvKey.signWithMessageHash(this.sHashHex,this.mdAlgName);else if(this.prvKey instanceof KJUR.crypto.ECDSA)this.hSign=this.prvKey.signWithMessageHash(this.sHashHex);else{if(!(this.prvKey instanceof KJUR.crypto.DSA))throw"Signature: unsupported public key alg: "+this.pubkeyAlgName;this.hSign=this.prvKey.signWithMessageHash(this.sHashHex)}return this.hSign},this.signString=function(a){return this.updateString(a),this.sign()},this.signHex=function(a){return this.updateHex(a),this.sign()},this.verify=function(a){if(this.sHashHex=this.md.digest(),"undefined"!=typeof this.ecpubhex&&"undefined"!=typeof this.eccurvename){var b=new KJUR.crypto.ECDSA({curve:this.eccurvename});return b.verifyHex(this.sHashHex,a,this.ecpubhex)}if(this.pubKey instanceof RSAKey&&"rsaandmgf1"==this.pubkeyAlgName)return this.pubKey.verifyWithMessageHashPSS(this.sHashHex,a,this.mdAlgName,this.pssSaltLen);if(this.pubKey instanceof RSAKey&&"rsa"==this.pubkeyAlgName)return this.pubKey.verifyWithMessageHash(this.sHashHex,a);if(this.pubKey instanceof KJUR.crypto.ECDSA)return this.pubKey.verifyWithMessageHash(this.sHashHex,a);if(this.pubKey instanceof KJUR.crypto.DSA)return this.pubKey.verifyWithMessageHash(this.sHashHex,a);throw"Signature: unsupported public key alg: "+this.pubkeyAlgName}}},this.init=function(a,b){throw"init(key, pass) not supported for this alg:prov="+this.algProvName},this.initVerifyByPublicKey=function(a){throw"initVerifyByPublicKey(rsaPubKeyy) not supported for this alg:prov="+this.algProvName},this.initVerifyByCertificatePEM=function(a){throw"initVerifyByCertificatePEM(certPEM) not supported for this alg:prov="+this.algProvName},this.initSign=function(a){throw"initSign(prvKey) not supported for this alg:prov="+this.algProvName},this.updateString=function(a){throw"updateString(str) not supported for this alg:prov="+this.algProvName},this.updateHex=function(a){throw"updateHex(hex) not supported for this alg:prov="+this.algProvName},this.sign=function(){throw"sign() not supported for this alg:prov="+this.algProvName},this.signString=function(a){throw"digestString(str) not supported for this alg:prov="+this.algProvName},this.signHex=function(a){throw"digestHex(hex) not supported for this alg:prov="+this.algProvName},this.verify=function(a){throw"verify(hSigVal) not supported for this alg:prov="+this.algProvName},this.initParams=a,void 0!==a&&(void 0!==a.alg&&(this.algName=a.alg,void 0===a.prov?this.provName=KJUR.crypto.Util.DEFAULTPROVIDER[this.algName]:this.provName=a.prov,this.algProvName=this.algName+":"+this.provName,this.setAlgAndProvider(this.algName,this.provName),this._setAlgNames()),void 0!==a.psssaltlen&&(this.pssSaltLen=a.psssaltlen),void 0!==a.prvkeypem)){if(void 0!==a.prvkeypas)throw"both prvkeypem and prvkeypas parameters not supported";try{var b=new RSAKey;b.readPrivateKeyFromPEMString(a.prvkeypem),this.initSign(b)}catch(a){throw"fatal error to load pem private key: "+a}}},KJUR.crypto.OID=new function(){this.oidhex2name={"2a864886f70d010101":"rsaEncryption","2a8648ce3d0201":"ecPublicKey","2a8648ce380401":"dsa","2a8648ce3d030107":"secp256r1","2b8104001f":"secp192k1","2b81040021":"secp224r1","2b8104000a":"secp256k1","2b81040023":"secp521r1","2b81040022":"secp384r1","2a8648ce380403":"SHA1withDSA","608648016503040301":"SHA224withDSA","608648016503040302":"SHA256withDSA"}};var KJUR;"undefined"!=typeof KJUR&&KJUR||(KJUR={}),"undefined"!=typeof KJUR.lang&&KJUR.lang||(KJUR.lang={}),KJUR.lang.String=function(){};var utf8tob64u,b64utoutf8;"function"==typeof Buffer?(utf8tob64u=function(a){return b64tob64u(new Buffer(a,"utf8").toString("base64"))},b64utoutf8=function(a){return new Buffer(b64utob64(a),"base64").toString("utf8")}):(utf8tob64u=function(a){return hextob64u(uricmptohex(encodeURIComponentAll(a)))},b64utoutf8=function(a){return decodeURIComponent(hextouricmp(b64utohex(a)))}),KJUR.lang.String.isInteger=function(a){return!!a.match(/^[0-9]+$/)||!!a.match(/^-[0-9]+$/)},KJUR.lang.String.isHex=function(a){return!(a.length%2!=0||!a.match(/^[0-9a-f]+$/)&&!a.match(/^[0-9A-F]+$/))},KJUR.lang.String.isBase64=function(a){return a=a.replace(/\s+/g,""),!(!a.match(/^[0-9A-Za-z+\/]+={0,3}$/)||a.length%4!=0)},KJUR.lang.String.isBase64URL=function(a){return!a.match(/[+/=]/)&&(a=b64utob64(a),KJUR.lang.String.isBase64(a))},KJUR.lang.String.isIntegerArray=function(a){return a=a.replace(/\s+/g,""),!!a.match(/^\[[0-9,]+\]$/)};var strdiffidx=function(a,b){var c=a.length;a.length>b.length&&(c=b.length);for(var d=0;d<c;d++)if(a.charCodeAt(d)!=b.charCodeAt(d))return d;return a.length!=b.length?c:-1};RSAKey.prototype.doPublic=RSADoPublic,RSAKey.prototype.setPublic=RSASetPublic,RSAKey.prototype.encrypt=RSAEncrypt,RSAKey.prototype.encryptOAEP=RSAEncryptOAEP,RSAKey.prototype.type="RSA";var _RE_HEXDECONLY=new RegExp("");_RE_HEXDECONLY.compile("[^0-9a-f]","gi"),RSAKey.prototype.signWithMessageHash=_rsasign_signWithMessageHash,RSAKey.prototype.signString=_rsasign_signString,RSAKey.prototype.signStringWithSHA1=_rsasign_signStringWithSHA1,RSAKey.prototype.signStringWithSHA256=_rsasign_signStringWithSHA256,RSAKey.prototype.sign=_rsasign_signString,RSAKey.prototype.signWithSHA1=_rsasign_signStringWithSHA1,RSAKey.prototype.signWithSHA256=_rsasign_signStringWithSHA256,RSAKey.prototype.signWithMessageHashPSS=_rsasign_signWithMessageHashPSS,RSAKey.prototype.signStringPSS=_rsasign_signStringPSS,RSAKey.prototype.signPSS=_rsasign_signStringPSS,RSAKey.SALT_LEN_HLEN=-1,RSAKey.SALT_LEN_MAX=-2,RSAKey.prototype.verifyWithMessageHash=_rsasign_verifyWithMessageHash,RSAKey.prototype.verifyString=_rsasign_verifyString,RSAKey.prototype.verifyHexSignatureForMessage=_rsasign_verifyHexSignatureForMessage,RSAKey.prototype.verify=_rsasign_verifyString,RSAKey.prototype.verifyHexSignatureForByteArrayMessage=_rsasign_verifyHexSignatureForMessage,RSAKey.prototype.verifyWithMessageHashPSS=_rsasign_verifyWithMessageHashPSS,RSAKey.prototype.verifyStringPSS=_rsasign_verifyStringPSS,RSAKey.prototype.verifyPSS=_rsasign_verifyStringPSS,RSAKey.SALT_LEN_RECOVER=-2;var KEYUTIL=function(){var a=function(a,b,c){return d(CryptoJS.AES,a,b,c)},b=function(a,b,c){return d(CryptoJS.TripleDES,a,b,c)},c=function(a,b,c){return d(CryptoJS.DES,a,b,c)},d=function(a,b,c,d){var e=CryptoJS.enc.Hex.parse(b),f=CryptoJS.enc.Hex.parse(c),g=CryptoJS.enc.Hex.parse(d),h={};h.key=f,h.iv=g,h.ciphertext=e;var i=a.decrypt(h,f,{iv:g});return CryptoJS.enc.Hex.stringify(i)},e=function(a,b,c){return h(CryptoJS.AES,a,b,c)},f=function(a,b,c){return h(CryptoJS.TripleDES,a,b,c)},g=function(a,b,c){return h(CryptoJS.DES,a,b,c)},h=function(a,b,c,d){var e=CryptoJS.enc.Hex.parse(b),f=CryptoJS.enc.Hex.parse(c),g=CryptoJS.enc.Hex.parse(d),h=a.encrypt(e,f,{iv:g}),i=CryptoJS.enc.Hex.parse(h.toString()),j=CryptoJS.enc.Base64.stringify(i);return j},i={"AES-256-CBC":{proc:a,eproc:e,keylen:32,ivlen:16},"AES-192-CBC":{proc:a,eproc:e,keylen:24,ivlen:16},"AES-128-CBC":{proc:a,eproc:e,keylen:16,ivlen:16},"DES-EDE3-CBC":{proc:b,eproc:f,keylen:24,ivlen:8},"DES-CBC":{proc:c,eproc:g,keylen:8,ivlen:8}},j=function(a){return i[a].proc},k=function(a){var b=CryptoJS.lib.WordArray.random(a),c=CryptoJS.enc.Hex.stringify(b);return c},l=function(a){var b={};a.match(new RegExp("DEK-Info: ([^,]+),([0-9A-Fa-f]+)","m"))&&(b.cipher=RegExp.$1,b.ivsalt=RegExp.$2),a.match(new RegExp("-----BEGIN ([A-Z]+) PRIVATE KEY-----"))&&(b.type=RegExp.$1);var c=-1,d=0;a.indexOf("\r\n\r\n")!=-1&&(c=a.indexOf("\r\n\r\n"),d=2),a.indexOf("\n\n")!=-1&&(c=a.indexOf("\n\n"),d=1);var e=a.indexOf("-----END");if(c!=-1&&e!=-1){var f=a.substring(c+2*d,e-d);f=f.replace(/\s+/g,""),b.data=f}return b},m=function(a,b,c){for(var d=c.substring(0,16),e=CryptoJS.enc.Hex.parse(d),f=CryptoJS.enc.Utf8.parse(b),g=i[a].keylen+i[a].ivlen,h="",j=null;;){var k=CryptoJS.algo.MD5.create();if(null!=j&&k.update(j),k.update(f),k.update(e),j=k.finalize(),h+=CryptoJS.enc.Hex.stringify(j),h.length>=2*g)break}var l={};return l.keyhex=h.substr(0,2*i[a].keylen),l.ivhex=h.substr(2*i[a].keylen,2*i[a].ivlen),l},n=function(a,b,c,d){var e=CryptoJS.enc.Base64.parse(a),f=CryptoJS.enc.Hex.stringify(e),g=i[b].proc,h=g(f,c,d);return h},o=function(a,b,c,d){var e=i[b].eproc,f=e(a,c,d);return f};return{version:"1.0.0",getHexFromPEM:function(a,b){var c=a;if(c.indexOf("-----BEGIN ")==-1)throw"can't find PEM header: "+b;"string"==typeof b&&""!=b?(c=c.replace("-----BEGIN "+b+"-----",""),c=c.replace("-----END "+b+"-----","")):(c=c.replace(/-----BEGIN [^-]+-----/,""),c=c.replace(/-----END [^-]+-----/,""));var d=c.replace(/\s+/g,""),e=b64tohex(d);return e},getDecryptedKeyHexByKeyIV:function(a,b,c,d){var e=j(b);return e(a,c,d)},parsePKCS5PEM:function(a){return l(a)},getKeyAndUnusedIvByPasscodeAndIvsalt:function(a,b,c){return m(a,b,c)},decryptKeyB64:function(a,b,c,d){return n(a,b,c,d)},getDecryptedKeyHex:function(a,b){var c=l(a),d=(c.type,c.cipher),e=c.ivsalt,f=c.data,g=m(d,b,e),h=g.keyhex,i=n(f,d,h,e);return i},getRSAKeyFromEncryptedPKCS5PEM:function(a,b){var c=this.getDecryptedKeyHex(a,b),d=new RSAKey;return d.readPrivateKeyFromASN1HexString(c),d},getEncryptedPKCS5PEMFromPrvKeyHex:function(a,b,c,d,e){var f="";if("undefined"!=typeof d&&null!=d||(d="AES-256-CBC"),"undefined"==typeof i[d])throw"KEYUTIL unsupported algorithm: "+d;if("undefined"==typeof e||null==e){var g=i[d].ivlen,h=k(g);e=h.toUpperCase()}var j=m(d,c,e),l=j.keyhex,n=o(b,d,l,e),p=n.replace(/(.{64})/g,"$1\r\n"),f="-----BEGIN "+a+" PRIVATE KEY-----\r\n";return f+="Proc-Type: 4,ENCRYPTED\r\n",f+="DEK-Info: "+d+","+e+"\r\n",f+="\r\n",f+=p,f+="\r\n-----END "+a+" PRIVATE KEY-----\r\n"},getEncryptedPKCS5PEMFromRSAKey:function(a,b,c,d){var e=new KJUR.asn1.DERInteger({int:0}),f=new KJUR.asn1.DERInteger({bigint:a.n}),g=new KJUR.asn1.DERInteger({int:a.e}),h=new KJUR.asn1.DERInteger({bigint:a.d}),i=new KJUR.asn1.DERInteger({bigint:a.p}),j=new KJUR.asn1.DERInteger({bigint:a.q}),k=new KJUR.asn1.DERInteger({bigint:a.dmp1}),l=new KJUR.asn1.DERInteger({bigint:a.dmq1}),m=new KJUR.asn1.DERInteger({bigint:a.coeff}),n=new KJUR.asn1.DERSequence({array:[e,f,g,h,i,j,k,l,m]}),o=n.getEncodedHex();return this.getEncryptedPKCS5PEMFromPrvKeyHex("RSA",o,b,c,d)},newEncryptedPKCS5PEM:function(a,b,c,d){"undefined"!=typeof b&&null!=b||(b=1024),"undefined"!=typeof c&&null!=c||(c="10001");var e=new RSAKey;e.generate(b,c);var f=null;return f="undefined"==typeof d||null==d?this.getEncryptedPKCS5PEMFromRSAKey(e,a):this.getEncryptedPKCS5PEMFromRSAKey(e,a,d)},getRSAKeyFromPlainPKCS8PEM:function(a){if(a.match(/ENCRYPTED/))throw"pem shall be not ENCRYPTED";var b=this.getHexFromPEM(a,"PRIVATE KEY"),c=this.getRSAKeyFromPlainPKCS8Hex(b);return c},getRSAKeyFromPlainPKCS8Hex:function(a){var b=ASN1HEX.getPosArrayOfChildren_AtObj(a,0);if(3!=b.length)throw"outer DERSequence shall have 3 elements: "+b.length;var c=ASN1HEX.getHexOfTLV_AtObj(a,b[1]);if("300d06092a864886f70d0101010500"!=c)throw"PKCS8 AlgorithmIdentifier is not rsaEnc: "+c;var c=ASN1HEX.getHexOfTLV_AtObj(a,b[1]),d=ASN1HEX.getHexOfTLV_AtObj(a,b[2]),e=ASN1HEX.getHexOfV_AtObj(d,0),f=new RSAKey;return f.readPrivateKeyFromASN1HexString(e),f},parseHexOfEncryptedPKCS8:function(a){var b={},c=ASN1HEX.getPosArrayOfChildren_AtObj(a,0);if(2!=c.length)throw"malformed format: SEQUENCE(0).items != 2: "+c.length;b.ciphertext=ASN1HEX.getHexOfV_AtObj(a,c[1]);var d=ASN1HEX.getPosArrayOfChildren_AtObj(a,c[0]);if(2!=d.length)throw"malformed format: SEQUENCE(0.0).items != 2: "+d.length;if("2a864886f70d01050d"!=ASN1HEX.getHexOfV_AtObj(a,d[0]))throw"this only supports pkcs5PBES2";var e=ASN1HEX.getPosArrayOfChildren_AtObj(a,d[1]);if(2!=d.length)throw"malformed format: SEQUENCE(0.0.1).items != 2: "+e.length;var f=ASN1HEX.getPosArrayOfChildren_AtObj(a,e[1]);if(2!=f.length)throw"malformed format: SEQUENCE(0.0.1.1).items != 2: "+f.length;if("2a864886f70d0307"!=ASN1HEX.getHexOfV_AtObj(a,f[0]))throw"this only supports TripleDES";b.encryptionSchemeAlg="TripleDES",b.encryptionSchemeIV=ASN1HEX.getHexOfV_AtObj(a,f[1]);var g=ASN1HEX.getPosArrayOfChildren_AtObj(a,e[0]);if(2!=g.length)throw"malformed format: SEQUENCE(0.0.1.0).items != 2: "+g.length;if("2a864886f70d01050c"!=ASN1HEX.getHexOfV_AtObj(a,g[0]))throw"this only supports pkcs5PBKDF2";var h=ASN1HEX.getPosArrayOfChildren_AtObj(a,g[1]);if(h.length<2)throw"malformed format: SEQUENCE(0.0.1.0.1).items < 2: "+h.length;b.pbkdf2Salt=ASN1HEX.getHexOfV_AtObj(a,h[0]);var i=ASN1HEX.getHexOfV_AtObj(a,h[1]);try{b.pbkdf2Iter=parseInt(i,16)}catch(a){throw"malformed format pbkdf2Iter: "+i}return b},getPBKDF2KeyHexFromParam:function(a,b){var c=CryptoJS.enc.Hex.parse(a.pbkdf2Salt),d=a.pbkdf2Iter,e=CryptoJS.PBKDF2(b,c,{keySize:6,iterations:d}),f=CryptoJS.enc.Hex.stringify(e);return f},getPlainPKCS8HexFromEncryptedPKCS8PEM:function(a,b){var c=this.getHexFromPEM(a,"ENCRYPTED PRIVATE KEY"),d=this.parseHexOfEncryptedPKCS8(c),e=KEYUTIL.getPBKDF2KeyHexFromParam(d,b),f={};f.ciphertext=CryptoJS.enc.Hex.parse(d.ciphertext);var g=CryptoJS.enc.Hex.parse(e),h=CryptoJS.enc.Hex.parse(d.encryptionSchemeIV),i=CryptoJS.TripleDES.decrypt(f,g,{iv:h}),j=CryptoJS.enc.Hex.stringify(i);return j},getRSAKeyFromEncryptedPKCS8PEM:function(a,b){var c=this.getPlainPKCS8HexFromEncryptedPKCS8PEM(a,b),d=this.getRSAKeyFromPlainPKCS8Hex(c);return d},getKeyFromEncryptedPKCS8PEM:function(a,b){var c=this.getPlainPKCS8HexFromEncryptedPKCS8PEM(a,b),d=this.getKeyFromPlainPrivatePKCS8Hex(c);return d},parsePlainPrivatePKCS8Hex:function(a){var b={};if(b.algparam=null,"30"!=a.substr(0,2))throw"malformed plain PKCS8 private key(code:001)";var c=ASN1HEX.getPosArrayOfChildren_AtObj(a,0);if(3!=c.length)throw"malformed plain PKCS8 private key(code:002)";if("30"!=a.substr(c[1],2))throw"malformed PKCS8 private key(code:003)";var d=ASN1HEX.getPosArrayOfChildren_AtObj(a,c[1]);if(2!=d.length)throw"malformed PKCS8 private key(code:004)";if("06"!=a.substr(d[0],2))throw"malformed PKCS8 private key(code:005)";if(b.algoid=ASN1HEX.getHexOfV_AtObj(a,d[0]),"06"==a.substr(d[1],2)&&(b.algparam=ASN1HEX.getHexOfV_AtObj(a,d[1])),"04"!=a.substr(c[2],2))throw"malformed PKCS8 private key(code:006)";return b.keyidx=ASN1HEX.getStartPosOfV_AtObj(a,c[2]),b},getKeyFromPlainPrivatePKCS8PEM:function(a){var b=this.getHexFromPEM(a,"PRIVATE KEY"),c=this.getKeyFromPlainPrivatePKCS8Hex(b);return c},getKeyFromPlainPrivatePKCS8Hex:function(a){var b=this.parsePlainPrivatePKCS8Hex(a);if("2a864886f70d010101"==b.algoid){this.parsePrivateRawRSAKeyHexAtObj(a,b);var c=b.key,d=new RSAKey;return d.setPrivateEx(c.n,c.e,c.d,c.p,c.q,c.dp,c.dq,c.co),d}if("2a8648ce3d0201"==b.algoid){if(this.parsePrivateRawECKeyHexAtObj(a,b),void 0===KJUR.crypto.OID.oidhex2name[b.algparam])throw"KJUR.crypto.OID.oidhex2name undefined: "+b.algparam;var e=KJUR.crypto.OID.oidhex2name[b.algparam],d=new KJUR.crypto.ECDSA({curve:e});return d.setPublicKeyHex(b.pubkey),d.setPrivateKeyHex(b.key),d.isPublic=!1,d}if("2a8648ce380401"==b.algoid){var f=ASN1HEX.getVbyList(a,0,[1,1,0],"02"),g=ASN1HEX.getVbyList(a,0,[1,1,1],"02"),h=ASN1HEX.getVbyList(a,0,[1,1,2],"02"),i=ASN1HEX.getVbyList(a,0,[2,0],"02"),j=new BigInteger(f,16),k=new BigInteger(g,16),l=new BigInteger(h,16),m=new BigInteger(i,16),d=new KJUR.crypto.DSA;return d.setPrivate(j,k,l,null,m),d}throw"unsupported private key algorithm"},getRSAKeyFromPublicPKCS8PEM:function(a){var b=this.getHexFromPEM(a,"PUBLIC KEY"),c=this.getRSAKeyFromPublicPKCS8Hex(b);return c},getKeyFromPublicPKCS8PEM:function(a){var b=this.getHexFromPEM(a,"PUBLIC KEY"),c=this.getKeyFromPublicPKCS8Hex(b);return c},getKeyFromPublicPKCS8Hex:function(a){var b=this.parsePublicPKCS8Hex(a);if("2a864886f70d010101"==b.algoid){var c=this.parsePublicRawRSAKeyHex(b.key),d=new RSAKey;return d.setPublic(c.n,c.e),d}if("2a8648ce3d0201"==b.algoid){if(void 0===KJUR.crypto.OID.oidhex2name[b.algparam])throw"KJUR.crypto.OID.oidhex2name undefined: "+b.algparam;var e=KJUR.crypto.OID.oidhex2name[b.algparam],d=new KJUR.crypto.ECDSA({curve:e,pub:b.key});return d}if("2a8648ce380401"==b.algoid){var f=b.algparam,g=ASN1HEX.getHexOfV_AtObj(b.key,0),d=new KJUR.crypto.DSA;return d.setPublic(new BigInteger(f.p,16),new BigInteger(f.q,16),new BigInteger(f.g,16),new BigInteger(g,16)),d}throw"unsupported public key algorithm"},parsePublicRawRSAKeyHex:function(a){var b={};if("30"!=a.substr(0,2))throw"malformed RSA key(code:001)";var c=ASN1HEX.getPosArrayOfChildren_AtObj(a,0);if(2!=c.length)throw"malformed RSA key(code:002)";if("02"!=a.substr(c[0],2))throw"malformed RSA key(code:003)";if(b.n=ASN1HEX.getHexOfV_AtObj(a,c[0]),"02"!=a.substr(c[1],2))throw"malformed RSA key(code:004)";return b.e=ASN1HEX.getHexOfV_AtObj(a,c[1]),b},parsePrivateRawRSAKeyHexAtObj:function(a,b){var c=b.keyidx;if("30"!=a.substr(c,2))throw"malformed RSA private key(code:001)";var d=ASN1HEX.getPosArrayOfChildren_AtObj(a,c);if(9!=d.length)throw"malformed RSA private key(code:002)";b.key={},b.key.n=ASN1HEX.getHexOfV_AtObj(a,d[1]),b.key.e=ASN1HEX.getHexOfV_AtObj(a,d[2]),b.key.d=ASN1HEX.getHexOfV_AtObj(a,d[3]),b.key.p=ASN1HEX.getHexOfV_AtObj(a,d[4]),b.key.q=ASN1HEX.getHexOfV_AtObj(a,d[5]),b.key.dp=ASN1HEX.getHexOfV_AtObj(a,d[6]),b.key.dq=ASN1HEX.getHexOfV_AtObj(a,d[7]),b.key.co=ASN1HEX.getHexOfV_AtObj(a,d[8])},parsePrivateRawECKeyHexAtObj:function(a,b){var c=b.keyidx,d=ASN1HEX.getVbyList(a,c,[1],"04"),e=ASN1HEX.getVbyList(a,c,[2,0],"03").substr(2);b.key=d,b.pubkey=e},parsePublicPKCS8Hex:function(a){var b={};b.algparam=null;var c=ASN1HEX.getPosArrayOfChildren_AtObj(a,0);if(2!=c.length)throw"outer DERSequence shall have 2 elements: "+c.length;var d=c[0];if("30"!=a.substr(d,2))throw"malformed PKCS8 public key(code:001)";var e=ASN1HEX.getPosArrayOfChildren_AtObj(a,d);if(2!=e.length)throw"malformed PKCS8 public key(code:002)";if("06"!=a.substr(e[0],2))throw"malformed PKCS8 public key(code:003)";if(b.algoid=ASN1HEX.getHexOfV_AtObj(a,e[0]),"06"==a.substr(e[1],2)?b.algparam=ASN1HEX.getHexOfV_AtObj(a,e[1]):"30"==a.substr(e[1],2)&&(b.algparam={},b.algparam.p=ASN1HEX.getVbyList(a,e[1],[0],"02"),b.algparam.q=ASN1HEX.getVbyList(a,e[1],[1],"02"),b.algparam.g=ASN1HEX.getVbyList(a,e[1],[2],"02")),"03"!=a.substr(c[1],2))throw"malformed PKCS8 public key(code:004)";return b.key=ASN1HEX.getHexOfV_AtObj(a,c[1]).substr(2),b},getRSAKeyFromPublicPKCS8Hex:function(a){var b=ASN1HEX.getPosArrayOfChildren_AtObj(a,0);if(2!=b.length)throw"outer DERSequence shall have 2 elements: "+b.length;var c=ASN1HEX.getHexOfTLV_AtObj(a,b[0]);if("300d06092a864886f70d0101010500"!=c)throw"PKCS8 AlgorithmId is not rsaEncryption";if("03"!=a.substr(b[1],2))throw"PKCS8 Public Key is not BITSTRING encapslated.";var d=ASN1HEX.getStartPosOfV_AtObj(a,b[1])+2;if("30"!=a.substr(d,2))throw"PKCS8 Public Key is not SEQUENCE.";var e=ASN1HEX.getPosArrayOfChildren_AtObj(a,d);if(2!=e.length)throw"inner DERSequence shall have 2 elements: "+e.length;if("02"!=a.substr(e[0],2))throw"N is not ASN.1 INTEGER";if("02"!=a.substr(e[1],2))throw"E is not ASN.1 INTEGER";var f=ASN1HEX.getHexOfV_AtObj(a,e[0]),g=ASN1HEX.getHexOfV_AtObj(a,e[1]),h=new RSAKey;return h.setPublic(f,g),h}}}();KEYUTIL.getKey=function(a,b,c){if("undefined"!=typeof RSAKey&&a instanceof RSAKey)return a;if("undefined"!=typeof KJUR.crypto.ECDSA&&a instanceof KJUR.crypto.ECDSA)return a;if("undefined"!=typeof KJUR.crypto.DSA&&a instanceof KJUR.crypto.DSA)return a;if(void 0!==a.curve&&void 0!==a.xy&&void 0===a.d)return new KJUR.crypto.ECDSA({pub:a.xy,curve:a.curve});if(void 0!==a.curve&&void 0!==a.d)return new KJUR.crypto.ECDSA({prv:a.d,curve:a.curve});if(void 0===a.kty&&void 0!==a.n&&void 0!==a.e&&void 0===a.d){var d=new RSAKey;return d.setPublic(a.n,a.e),d}if(void 0===a.kty&&void 0!==a.n&&void 0!==a.e&&void 0!==a.d&&void 0!==a.p&&void 0!==a.q&&void 0!==a.dp&&void 0!==a.dq&&void 0!==a.co&&void 0===a.qi){var d=new RSAKey;return d.setPrivateEx(a.n,a.e,a.d,a.p,a.q,a.dp,a.dq,a.co),d}if(void 0===a.kty&&void 0!==a.n&&void 0!==a.e&&void 0!==a.d&&void 0===a.p){var d=new RSAKey;return d.setPrivate(a.n,a.e,a.d),d}if(void 0!==a.p&&void 0!==a.q&&void 0!==a.g&&void 0!==a.y&&void 0===a.x){var d=new KJUR.crypto.DSA;return d.setPublic(a.p,a.q,a.g,a.y),d}if(void 0!==a.p&&void 0!==a.q&&void 0!==a.g&&void 0!==a.y&&void 0!==a.x){var d=new KJUR.crypto.DSA;return d.setPrivate(a.p,a.q,a.g,a.y,a.x),d}if("RSA"===a.kty&&void 0!==a.n&&void 0!==a.e&&void 0===a.d){var d=new RSAKey;return d.setPublic(b64utohex(a.n),b64utohex(a.e)),d}if("RSA"===a.kty&&void 0!==a.n&&void 0!==a.e&&void 0!==a.d&&void 0!==a.p&&void 0!==a.q&&void 0!==a.dp&&void 0!==a.dq&&void 0!==a.qi){var d=new RSAKey;return d.setPrivateEx(b64utohex(a.n),b64utohex(a.e),b64utohex(a.d),b64utohex(a.p),b64utohex(a.q),b64utohex(a.dp),b64utohex(a.dq),b64utohex(a.qi)),d}if("RSA"===a.kty&&void 0!==a.n&&void 0!==a.e&&void 0!==a.d){var d=new RSAKey;return d.setPrivate(b64utohex(a.n),b64utohex(a.e),b64utohex(a.d)),d}if("EC"===a.kty&&void 0!==a.crv&&void 0!==a.x&&void 0!==a.y&&void 0===a.d){var e=new KJUR.crypto.ECDSA({curve:a.crv}),f=e.ecparams.keylen/4,g=("0000000000"+b64utohex(a.x)).slice(-f),h=("0000000000"+b64utohex(a.y)).slice(-f),i="04"+g+h;return e.setPublicKeyHex(i),e}if("EC"===a.kty&&void 0!==a.crv&&void 0!==a.x&&void 0!==a.y&&void 0!==a.d){var e=new KJUR.crypto.ECDSA({curve:a.crv}),f=e.ecparams.keylen/4,g=("0000000000"+b64utohex(a.x)).slice(-f),h=("0000000000"+b64utohex(a.y)).slice(-f),i="04"+g+h,j=("0000000000"+b64utohex(a.d)).slice(-f);
return e.setPublicKeyHex(i),e.setPrivateKeyHex(j),e}if(a.indexOf("-END CERTIFICATE-",0)!=-1||a.indexOf("-END X509 CERTIFICATE-",0)!=-1||a.indexOf("-END TRUSTED CERTIFICATE-",0)!=-1)return X509.getPublicKeyFromCertPEM(a);if("pkcs8pub"===c)return KEYUTIL.getKeyFromPublicPKCS8Hex(a);if(a.indexOf("-END PUBLIC KEY-")!=-1)return KEYUTIL.getKeyFromPublicPKCS8PEM(a);if("pkcs5prv"===c){var d=new RSAKey;return d.readPrivateKeyFromASN1HexString(a),d}if("pkcs5prv"===c){var d=new RSAKey;return d.readPrivateKeyFromASN1HexString(a),d}if(a.indexOf("-END RSA PRIVATE KEY-")!=-1&&a.indexOf("4,ENCRYPTED")==-1){var k=KEYUTIL.getHexFromPEM(a,"RSA PRIVATE KEY");return KEYUTIL.getKey(k,null,"pkcs5prv")}if(a.indexOf("-END DSA PRIVATE KEY-")!=-1&&a.indexOf("4,ENCRYPTED")==-1){var l=this.getHexFromPEM(a,"DSA PRIVATE KEY"),m=ASN1HEX.getVbyList(l,0,[1],"02"),n=ASN1HEX.getVbyList(l,0,[2],"02"),o=ASN1HEX.getVbyList(l,0,[3],"02"),p=ASN1HEX.getVbyList(l,0,[4],"02"),q=ASN1HEX.getVbyList(l,0,[5],"02"),d=new KJUR.crypto.DSA;return d.setPrivate(new BigInteger(m,16),new BigInteger(n,16),new BigInteger(o,16),new BigInteger(p,16),new BigInteger(q,16)),d}if(a.indexOf("-END PRIVATE KEY-")!=-1)return KEYUTIL.getKeyFromPlainPrivatePKCS8PEM(a);if(a.indexOf("-END RSA PRIVATE KEY-")!=-1&&a.indexOf("4,ENCRYPTED")!=-1)return KEYUTIL.getRSAKeyFromEncryptedPKCS5PEM(a,b);if(a.indexOf("-END EC PRIVATE KEY-")!=-1&&a.indexOf("4,ENCRYPTED")!=-1){var l=KEYUTIL.getDecryptedKeyHex(a,b),d=ASN1HEX.getVbyList(l,0,[1],"04"),r=ASN1HEX.getVbyList(l,0,[2,0],"06"),s=ASN1HEX.getVbyList(l,0,[3,0],"03").substr(2),t="";if(void 0===KJUR.crypto.OID.oidhex2name[r])throw"undefined OID(hex) in KJUR.crypto.OID: "+r;t=KJUR.crypto.OID.oidhex2name[r];var e=new KJUR.crypto.ECDSA({name:t});return e.setPublicKeyHex(s),e.setPrivateKeyHex(d),e.isPublic=!1,e}if(a.indexOf("-END DSA PRIVATE KEY-")!=-1&&a.indexOf("4,ENCRYPTED")!=-1){var l=KEYUTIL.getDecryptedKeyHex(a,b),m=ASN1HEX.getVbyList(l,0,[1],"02"),n=ASN1HEX.getVbyList(l,0,[2],"02"),o=ASN1HEX.getVbyList(l,0,[3],"02"),p=ASN1HEX.getVbyList(l,0,[4],"02"),q=ASN1HEX.getVbyList(l,0,[5],"02"),d=new KJUR.crypto.DSA;return d.setPrivate(new BigInteger(m,16),new BigInteger(n,16),new BigInteger(o,16),new BigInteger(p,16),new BigInteger(q,16)),d}if(a.indexOf("-END ENCRYPTED PRIVATE KEY-")!=-1)return KEYUTIL.getKeyFromEncryptedPKCS8PEM(a,b);throw"not supported argument"},KEYUTIL.generateKeypair=function(a,b){if("RSA"==a){var c=b,d=new RSAKey;d.generate(c,"10001"),d.isPrivate=!0,d.isPublic=!0;var e=new RSAKey,f=d.n.toString(16),g=d.e.toString(16);e.setPublic(f,g),e.isPrivate=!1,e.isPublic=!0;var h={};return h.prvKeyObj=d,h.pubKeyObj=e,h}if("EC"==a){var i=b,j=new KJUR.crypto.ECDSA({curve:i}),k=j.generateKeyPairHex(),d=new KJUR.crypto.ECDSA({curve:i});d.setPublicKeyHex(k.ecpubhex),d.setPrivateKeyHex(k.ecprvhex),d.isPrivate=!0,d.isPublic=!1;var e=new KJUR.crypto.ECDSA({curve:i});e.setPublicKeyHex(k.ecpubhex),e.isPrivate=!1,e.isPublic=!0;var h={};return h.prvKeyObj=d,h.pubKeyObj=e,h}throw"unknown algorithm: "+a},KEYUTIL.getPEM=function(a,b,c,d,e){function f(a){var b=KJUR.asn1.ASN1Util.newObject({seq:[{int:0},{int:{bigint:a.n}},{int:a.e},{int:{bigint:a.d}},{int:{bigint:a.p}},{int:{bigint:a.q}},{int:{bigint:a.dmp1}},{int:{bigint:a.dmq1}},{int:{bigint:a.coeff}}]});return b}function g(a){var b=KJUR.asn1.ASN1Util.newObject({seq:[{int:1},{octstr:{hex:a.prvKeyHex}},{tag:["a0",!0,{oid:{name:a.curveName}}]},{tag:["a1",!0,{bitstr:{hex:"00"+a.pubKeyHex}}]}]});return b}function h(a){var b=KJUR.asn1.ASN1Util.newObject({seq:[{int:0},{int:{bigint:a.p}},{int:{bigint:a.q}},{int:{bigint:a.g}},{int:{bigint:a.y}},{int:{bigint:a.x}}]});return b}var i=KJUR.asn1,j=KJUR.crypto;if(("undefined"!=typeof RSAKey&&a instanceof RSAKey||"undefined"!=typeof j.DSA&&a instanceof j.DSA||"undefined"!=typeof j.ECDSA&&a instanceof j.ECDSA)&&1==a.isPublic&&(void 0===b||"PKCS8PUB"==b)){var k=new KJUR.asn1.x509.SubjectPublicKeyInfo(a),l=k.getEncodedHex();return i.ASN1Util.getPEMStringFromHex(l,"PUBLIC KEY")}if("PKCS1PRV"==b&&"undefined"!=typeof RSAKey&&a instanceof RSAKey&&(void 0===c||null==c)&&1==a.isPrivate){var k=f(a),l=k.getEncodedHex();return i.ASN1Util.getPEMStringFromHex(l,"RSA PRIVATE KEY")}if("PKCS1PRV"==b&&"undefined"!=typeof RSAKey&&a instanceof KJUR.crypto.ECDSA&&(void 0===c||null==c)&&1==a.isPrivate){var m=new KJUR.asn1.DERObjectIdentifier({name:a.curveName}),n=m.getEncodedHex(),o=g(a),p=o.getEncodedHex(),q="";return q+=i.ASN1Util.getPEMStringFromHex(n,"EC PARAMETERS"),q+=i.ASN1Util.getPEMStringFromHex(p,"EC PRIVATE KEY")}if("PKCS1PRV"==b&&"undefined"!=typeof KJUR.crypto.DSA&&a instanceof KJUR.crypto.DSA&&(void 0===c||null==c)&&1==a.isPrivate){var k=h(a),l=k.getEncodedHex();return i.ASN1Util.getPEMStringFromHex(l,"DSA PRIVATE KEY")}if("PKCS5PRV"==b&&"undefined"!=typeof RSAKey&&a instanceof RSAKey&&void 0!==c&&null!=c&&1==a.isPrivate){var k=f(a),l=k.getEncodedHex();return void 0===d&&(d="DES-EDE3-CBC"),this.getEncryptedPKCS5PEMFromPrvKeyHex("RSA",l,c,d)}if("PKCS5PRV"==b&&"undefined"!=typeof KJUR.crypto.ECDSA&&a instanceof KJUR.crypto.ECDSA&&void 0!==c&&null!=c&&1==a.isPrivate){var k=g(a),l=k.getEncodedHex();return void 0===d&&(d="DES-EDE3-CBC"),this.getEncryptedPKCS5PEMFromPrvKeyHex("EC",l,c,d)}if("PKCS5PRV"==b&&"undefined"!=typeof KJUR.crypto.DSA&&a instanceof KJUR.crypto.DSA&&void 0!==c&&null!=c&&1==a.isPrivate){var k=h(a),l=k.getEncodedHex();return void 0===d&&(d="DES-EDE3-CBC"),this.getEncryptedPKCS5PEMFromPrvKeyHex("DSA",l,c,d)}var r=function(a,b){var c=s(a,b),d=new KJUR.asn1.ASN1Util.newObject({seq:[{seq:[{oid:{name:"pkcs5PBES2"}},{seq:[{seq:[{oid:{name:"pkcs5PBKDF2"}},{seq:[{octstr:{hex:c.pbkdf2Salt}},{int:c.pbkdf2Iter}]}]},{seq:[{oid:{name:"des-EDE3-CBC"}},{octstr:{hex:c.encryptionSchemeIV}}]}]}]},{octstr:{hex:c.ciphertext}}]});return d.getEncodedHex()},s=function(a,b){var c=100,d=CryptoJS.lib.WordArray.random(8),e="DES-EDE3-CBC",f=CryptoJS.lib.WordArray.random(8),g=CryptoJS.PBKDF2(b,d,{keySize:6,iterations:c}),h=CryptoJS.enc.Hex.parse(a),i=CryptoJS.TripleDES.encrypt(h,g,{iv:f})+"",j={};return j.ciphertext=i,j.pbkdf2Salt=CryptoJS.enc.Hex.stringify(d),j.pbkdf2Iter=c,j.encryptionSchemeAlg=e,j.encryptionSchemeIV=CryptoJS.enc.Hex.stringify(f),j};if("PKCS8PRV"==b&&"undefined"!=typeof RSAKey&&a instanceof RSAKey&&1==a.isPrivate){var t=f(a),u=t.getEncodedHex(),k=KJUR.asn1.ASN1Util.newObject({seq:[{int:0},{seq:[{oid:{name:"rsaEncryption"}},{null:!0}]},{octstr:{hex:u}}]}),l=k.getEncodedHex();if(void 0===c||null==c)return i.ASN1Util.getPEMStringFromHex(l,"PRIVATE KEY");var p=r(l,c);return i.ASN1Util.getPEMStringFromHex(p,"ENCRYPTED PRIVATE KEY")}if("PKCS8PRV"==b&&"undefined"!=typeof KJUR.crypto.ECDSA&&a instanceof KJUR.crypto.ECDSA&&1==a.isPrivate){var t=new KJUR.asn1.ASN1Util.newObject({seq:[{int:1},{octstr:{hex:a.prvKeyHex}},{tag:["a1",!0,{bitstr:{hex:"00"+a.pubKeyHex}}]}]}),u=t.getEncodedHex(),k=KJUR.asn1.ASN1Util.newObject({seq:[{int:0},{seq:[{oid:{name:"ecPublicKey"}},{oid:{name:a.curveName}}]},{octstr:{hex:u}}]}),l=k.getEncodedHex();if(void 0===c||null==c)return i.ASN1Util.getPEMStringFromHex(l,"PRIVATE KEY");var p=r(l,c);return i.ASN1Util.getPEMStringFromHex(p,"ENCRYPTED PRIVATE KEY")}if("PKCS8PRV"==b&&"undefined"!=typeof KJUR.crypto.DSA&&a instanceof KJUR.crypto.DSA&&1==a.isPrivate){var t=new KJUR.asn1.DERInteger({bigint:a.x}),u=t.getEncodedHex(),k=KJUR.asn1.ASN1Util.newObject({seq:[{int:0},{seq:[{oid:{name:"dsa"}},{seq:[{int:{bigint:a.p}},{int:{bigint:a.q}},{int:{bigint:a.g}}]}]},{octstr:{hex:u}}]}),l=k.getEncodedHex();if(void 0===c||null==c)return i.ASN1Util.getPEMStringFromHex(l,"PRIVATE KEY");var p=r(l,c);return i.ASN1Util.getPEMStringFromHex(p,"ENCRYPTED PRIVATE KEY")}throw"unsupported object nor format"},KEYUTIL.getKeyFromCSRPEM=function(a){var b=KEYUTIL.getHexFromPEM(a,"CERTIFICATE REQUEST"),c=KEYUTIL.getKeyFromCSRHex(b);return c},KEYUTIL.getKeyFromCSRHex=function(a){var b=KEYUTIL.parseCSRHex(a),c=KEYUTIL.getKey(b.p8pubkeyhex,null,"pkcs8pub");return c},KEYUTIL.parseCSRHex=function(a){var b={},c=a;if("30"!=c.substr(0,2))throw"malformed CSR(code:001)";var d=ASN1HEX.getPosArrayOfChildren_AtObj(c,0);if(d.length<1)throw"malformed CSR(code:002)";if("30"!=c.substr(d[0],2))throw"malformed CSR(code:003)";var e=ASN1HEX.getPosArrayOfChildren_AtObj(c,d[0]);if(e.length<3)throw"malformed CSR(code:004)";return b.p8pubkeyhex=ASN1HEX.getHexOfTLV_AtObj(c,e[2]),b},KEYUTIL.getJWKFromKey=function(a){var b={};if(a instanceof RSAKey&&a.isPrivate)return b.kty="RSA",b.n=hextob64u(a.n.toString(16)),b.e=hextob64u(a.e.toString(16)),b.d=hextob64u(a.d.toString(16)),b.p=hextob64u(a.p.toString(16)),b.q=hextob64u(a.q.toString(16)),b.dp=hextob64u(a.dmp1.toString(16)),b.dq=hextob64u(a.dmq1.toString(16)),b.qi=hextob64u(a.coeff.toString(16)),b;if(a instanceof RSAKey&&a.isPublic)return b.kty="RSA",b.n=hextob64u(a.n.toString(16)),b.e=hextob64u(a.e.toString(16)),b;if(a instanceof KJUR.crypto.ECDSA&&a.isPrivate){var c=a.getShortNISTPCurveName();if("P-256"!==c&&"P-384"!==c)throw"unsupported curve name for JWT: "+c;var d=a.getPublicKeyXYHex();return b.kty="EC",b.crv=c,b.x=hextob64u(d.x),b.y=hextob64u(d.y),b.d=hextob64u(a.prvKeyHex),b}if(a instanceof KJUR.crypto.ECDSA&&a.isPublic){var c=a.getShortNISTPCurveName();if("P-256"!==c&&"P-384"!==c)throw"unsupported curve name for JWT: "+c;var d=a.getPublicKeyXYHex();return b.kty="EC",b.crv=c,b.x=hextob64u(d.x),b.y=hextob64u(d.y),b}throw"not supported key object"};